const getModalItemData=async t=>{let e={},a={},l="",n="";window.localStorage;return parentPageCollectionData(),t&&(l=t.collectionId,n=t.itemId),l&&n&&("reset-password"!==l&&(t=`items/${l}/item/`+n,t=await securedGetCall(t),a=t?t.data:{}),e={itemData:a,collectionId:l,collectionItemId:n}),e},extractAllComponent=(e,t)=>{t.forEach(t=>{t.components&&extractAllComponent(e,t.components),e.push(t)})},getCustomFormThemesStyle=(t=!1)=>{let e="";return t&&(e=formDefaultStyle),e+=`
    .sortable-asc:after {
      font-family: 'Font Awesome 5 free';
      content: "\\f884";
      margin-left: 10px;
      }
    .sortable-desc:after {
      font-family: 'Font Awesome 5 free';
      content: "\\f160";
      margin-left: 10px;
      }
    `},checkComponents=t=>{const e=[];t&&((t=JSON.parse(t))||0<t.length)&&extractAllComponent(e,t);let a=e.filter(t=>"form"===t.tagName),l=[],n=[];return a.forEach(t=>{l=[],(l=t&&t.classes&&Array.isArray(t.classes)?t.classes.filter(t=>t.name.startsWith("dc-form-theme")||t.name.startsWith("dc-form-default")):l)&&l[0]&&(n.includes(l[0].name)||n.push(l[0].name))}),n.includes("dc-form-default")},checkForTextAreaType=async()=>{const t=$("[id^=modal-container] textarea");t.length&&t.each(function(){let n=$(this);n[0].hasAttribute("data-show-editor")&&n.summernote({toolbar:[["font",["fontname","fontsize"]],["style",["bold","italic","underline","strikethrough","superscript","subscript","color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture"]],["view",["undo","redo","clear","codeview"]]],height:100,tabsize:2,focus:!0,callbacks:{onImageUpload:async function(t,e,a){const l=new FormData;l.append("file",t[0]),t=(await multipartFormDataSecuredCall(l,"file/editor")).data,t=$("<img>").attr({src:s3BucketURL+"/"+t.key});n.summernote("insertNode",t[0])}}})})},checkForDateType=async()=>{const t=$("[id^=modal-container] input[type=datetime-local], [id^=modal-container] input[type=date]");t.length&&t.each(function(){let t=$(this);var e="datetime-local"===$(t[0]).attr("type"),a=$(t[0]).attr("placeholder");t.attr("autocomplete","off"),t.attr("placeholder",e?a+" (YYYY-MM-DD HH:MM)":a+" (YYYY-MM-DD)"),t.attr("flat-picker-date-type",e?"datetime-local":"date"),t?.flatpickr({enableTime:e,dateFormat:e?"Y-m-d H:i":"Y-m-d",time_24hr:!0,minuteIncrement:1,allowInput:!0,disableMobile:!0,onOpen:function(t,e,a){$(a.altInput).prop("readonly",!0)},onClose:function(t,e,a){$(a.altInput).prop("readonly",!1),$(a.altInput).blur()}})})},checkForTelType=async()=>{const t=$("[id^=modal-container] input[type=tel]");t.length&&t.intlTelInput({utilsScript:"/lib/intl-tel-input/utils.js"})},checkForSelectType=async()=>{$("[id^=modal-container] .select").on("change",function(){const t=$(this).val();var e;Array.isArray(t)&&1<t.length?-1<(e=t.indexOf(""))&&(t.splice(e,1),$(this).val(t)):Array.isArray(t)&&0===t.length&&$(this).val(""),$(this).trigger("change.select2")})},extractModalFormComponent=t=>{t=$(`[id^=${t}] form`);return t.length?t:""},loadDynamicSelectOptionsForModal=async(l,n)=>{const t=$("[id^=modal-container] .select");t.length&&t.each(function(){let t=$(this)[0],e=t.getAttribute("data-form-element-collection");var a=l.fields.filter(t=>t.fieldName===e);loadDynamicSelectOptions(t,JSON.stringify(a[0]),"","",!0,n)})},insertModalFormElementValue=(e,a,t)=>{if(isCheckbox(a))e&&(a.checked=!0);else if("file"===a.type){let t=a.parentElement.getElementsByClassName("file-list-display")[0];if(e&&"object"==typeof e&&(t.innerHTML=e.originalName),e&&Array.isArray(e)){const n=e.map(t=>t.originalName||"");t.innerHTML=n.join(",")}const l=a.parentElement.querySelector(`input[name="${a.name}"][type='hidden']`);l.value="object"==typeof e?JSON.stringify(e):""}else"datetime-local"===a.type?a.value=e?timestampToDatetimeInputString(new Date(e)):"":"datetime-local"===$(a).attr("flat-picker-date-type")?a.value=e?flatpickr.formatDate(new Date(e),"Y-m-d h:i K"):"":"SELECT"!==a.tagName&&("TEXTAREA"===a.tagName&&a.hasAttribute("data-show-editor")?$(a).summernote("code",e):"tel"===$(a).attr("type")?$(a).intlTelInput("setNumber",e):a.value=e)},collectionFormDetailForModalUpdate=async(t,e,a=null)=>{let l="";var n;a&&(l=a.collectionId,a.itemId),l&&(n=`collection-details/${l}/name`,(n=await securedGetCall(n))&&200===n.status&&loadDynamicSelectOptionsForModal(n.data,a)),t.method="put",t.setAttribute("action",t.getAttribute("action")+"/"+e.uuid)},collectionFormDetailForModal=async(t,e=null)=>{let a="";var l;(a=e?e.collectionId:a)&&(l=`collection-details/${a}/name`,(l=await securedGetCall(l))&&200===l.status&&loadDynamicSelectOptionsForModal(l.data,e)),t.method="put",t.setAttribute("action",t.getAttribute("action"))},addModalExternalScriptUrl=(t,a)=>{if(t.externalScriptURL){const e=t&&t.externalScriptURL?t.externalScriptURL.split(","):"";e&&e.forEach(t=>{let e=document.createElement("script");e.src=t.trim(),e.async=!0,e.defer=!0,a.appendChild(e)})}},addModalCustomScript=(l,n)=>{if(l.customScript){let t=l.customScript.trim(),e=t.startsWith("<script>")?t.replace("<script>",""):t,a=(e=e.endsWith("<\/script>")?e.replace("<\/script>",""):e,document.createElement("script"));l=document.createTextNode(""+e.trim());a.appendChild(l),n.appendChild(a)}},fetchCollectionByName=async t=>{if(t)return(t=await securedGetCall(`collection-details/${t}/name`))&&200===t.status?t.data:null},checkAndCreateValidationJS=async(t,e)=>{const a=t.filter(t=>{if(t&&t.attributes)return Object.keys(t.attributes).includes("data-form-validation")});t=await a.map(async t=>{var t=t["attributes"],e=t.id,a=t["data-form-collection"];const l=t["data-form-validation"],n=(await fetchCollectionByName(a))["validations"];t=n&&0<n.length?n.find(t=>t.uuid===l):null;if(t){const i=t["validationRules"],o={},r={};i.forEach(t=>{const e=o[t.field],a=(e?(e[t.key]=t.value,o[t.field]=e):o[t.field]={[t.key]:t.value},r[t.field]);a?(a[t.key]=t.message,r[t.field]=a):r[t.field]={[t.key]:t.message}});a={rules:o,messages:r};return`$("#${e}").validate(${JSON.stringify(a)});`}return""});const l=(await Promise.all(t)).join("\n");let n=document.createElement("script");t=document.createTextNode(""+l.trim());n.appendChild(t),e.appendChild(n)},extractModalFormComponents=t=>{const e=[];t&&((t=JSON.parse(t))||0<t.length)&&extractAllComponent(e,t);t=e.filter(t=>"form"===t.tagName);return t},parentPageCollectionData=()=>{const t=window.sessionStorage;var e=window.location.pathname.split("/"),a=e[e.length-2];let l=e[e.length-1];l&&l.includes("_")&&(l=l.split("_")[1]);e={page_collection:{name:a&&l?a:"",itemId:a&&l?l:""}},a=t.getItem("previousActionResponse");a?(a=JSON.parse(a),t.setItem("previousActionResponse",JSON.stringify({...a,...e}))):t.setItem("previousActionResponse",JSON.stringify(e))};
//# sourceMappingURL=drapcode.modal.js.map