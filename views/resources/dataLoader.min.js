let paginationDataMap=new Map,replaceTextContent=!1,renderImgContent=!1,stylesMap=new Map,dataTablePaginationDataMap=new Map,dataTableStylesMap=new Map;function getNumberOfPages(e,t){return Math.ceil(e/t)}function uuidv4(){return"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}const findComponentIndex=(t,a)=>{return Object.keys(t).findIndex(e=>t[e].getAttribute("data-gjs")===a)},createContentPlaceholder=(t,a,r)=>{let l="";var n=r.includes("list-group-item"),e=localStorage.getItem("loadingIconKey");if(e&&"PLACEHOLDER"!==e)"PLAIN_SPINNER"===e?l=`<div class="drapcode-spinner-plane ${a}-placeholder"></div>`:"CHASE_SPINNER"===e?l=`<div class="sk-chase ${a}-placeholder"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>`:"BAR_SPINNER"===e?l=`<div class="drapcode-spinner-bar ${a}-placeholder"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>`:"DOT_SPINNER"===e?l=`<div class="drapcode-spinner-dot ${a}-placeholder"><div class="dot1"></div><div class="dot2"></div></div>`:"FADING_CIRCLE_SPINNER"===e?l=`<div class="sk-fading-circle ${a}-placeholder"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>`:"BOUNCE_SPINNER"===e?l=`<div class="drapcode-spinner-bounce ${a}-placeholder"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>`:"NONE"===e&&(l="");else for(let e=0;e<t;e++)l+=n?`<div class="${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-4"></div><div class="drapcode-col-4"></div><div class="drapcode-col-6"></div></div></div></div>`:`<div class="drapcode-item ${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-picture"></div><div class="drapcode-row"><div class="drapcode-col-6 big"></div><div class="drapcode-col-4 empty big"></div><div class="drapcode-col-2 big"></div><div class="drapcode-col-4"></div><div class="drapcode-col-8 empty"></div><div class="drapcode-col-6"></div><div class="drapcode-col-6 empty"></div><div class="drapcode-col-12"></div></div></div></div>`;return l},loadDataGroupItems=async(a,r)=>{var{finderId:l,collectionName:n,fieldName:e,numberPerPage:i,dataGroupChildren:s,externalQueryParamKeys:d,searchString:o}=a,t=findComponentIndex(s,"search-form"),c=s[t];const u=s;c&&c.length&&u[t].remove();t=createContentPlaceholder(i||1,u[0].id,u[0].className);r.innerHTML="";const m=document.createElement("div");m.classList.add("data-group-content"+elementAttribute(r,"id")),m.classList.add("row"),m.innerHTML=t,r.style.display="";i=s[findComponentIndex(s,"data-group-map")],c&&r.appendChild(c),i&&r.appendChild(i),r.appendChild(m),t=findComponentIndex(s,"pagination"),c=s[t];c&&r.appendChild(c),a.replacedElement=m,a.originalDataGroup=r;let p=!1;i=(await getPageItemData()).itemData;if(l){let e=`collection-table/${n}/finder/${l}/items/count?`,t=(e=prepareItemDataAndExternalQueryParam(d,e,i,r),await searchQueryStringFromUrl());void 0!==o&&o?e=t?(t.startsWith("?")&&(t=t.replace("?","&")),e+"&"+o+t):e+"&"+o:t&&(t.startsWith("?")&&(t=t.replace("?","&")),e+=t);s=await securedGetCall(e);a.numberOfPages=getNumberOfPages(s.data,a.numberPerPage),p=s?s._$isPrivateFilter:null}else if(e){t=parseValueFromData(i,e);a.numberOfPages=1,a.filteredItemsUrl=`collection-table/${n}/itemList`,a.itemIds=t}else{c=Object.fromEntries(new URLSearchParams(window.location.search));console.log("::::::searchQuery11:::::::",c);let e="";"externalId"in c&&(e=c.externalId),console.log("::::::::externalApiMiddlewareId:::::",e),a.filteredItemsUrl=`external-api-middleware/${e}/collection-items`}loadGroupData(a,p)};async function loadGroupData(e,t){var a,r,l,{numberPerPage:n,numberOfPages:i,filteredItemsUrl:s,dataGroupChildren:d,replacedElement:o,currentPage:c,searchString:u,originalDataGroup:m,itemIds:p,fieldName:g,collectionName:v,externalQueryParamKeys:f}=e;addPaginationDataToDataMap(e,m);let h=await searchQueryStringFromUrl(),b=s,y="";g||(e=(c-1)*n,g=(y=e,b=s+`?offset=${e}&limit=`+n,void 0!==u&&u?b=h?(h.startsWith("?")&&(h=h.replace("?","&")),b+"&"+u+h):b+"&"+u:h&&(h.startsWith("?")&&(h=h.replace("?","&")),b+=h),await getPageItemData())["itemData"],b=prepareItemDataAndExternalQueryParam(f,b,g,m)),await renderDataGroupItem(v,b,d,o,m,p,y,stylesMap,t),validatePaginationButton(i,c,m);for([a,r]of stylesMap)selectorExists(`[id^="${a}"]`)||(l=`*[id^="${a}"] `+r,addStyle(l))}const addPaginationDataToDataMap=async(e,t)=>{paginationDataMap.set("pdata_"+t.id,e)},renderDataGroupItem=async(e,t,a,r,l,n,i="",s,d)=>{let o=[];t&&(0<(o=n?Array.isArray(n)?n:0<Object.keys(n).length?[n]:[]:(await securedGetCall(t)).data).length?(renderMapData(o,l),renderData(e,o,a,r,i,s)):r.innerHTML=d?"<div class='col-md-12 text-center'>This data is private hence cannot be displayed</div>":"<div class='col-md-12 text-center'></div>")},elementSelector=(e,t)=>e.querySelector(t),validatePaginationButton=(e,t,a)=>{const r=elementSelector(a,".loadMore"),l=elementSelector(a,".next"),n=elementSelector(a,".previous"),i=elementSelector(a,".first"),s=elementSelector(a,".last");r&&(r.disabled=t===e),l&&(l.disabled=t===e),n&&(n.disabled=1===t),i&&(i.disabled=1===t),s&&(s.disabled=t===e)},renderMapData=(i,s)=>{Object.keys(s.children).forEach(e=>{const t=s.children[e];var a,r,l,n;"data-group-map"===elementAttribute(t,"data-gjs")&&(e=elementAttribute(t,"data-group-map-lat"),a=elementAttribute(t,"data-group-map-long"),r=elementAttribute(t,"data-group-map-header"),l=elementAttribute(t,"data-group-map-description"),n=t.id,t.innerHTML=`<div id="map-${n}" class="map"></div> <style>.map{
      height:100%;width:100%;
       }</style>`,n=new google.maps.Map(document.getElementById("map-"+n),{zoom:15,center:new google.maps.LatLng(Number(i[0][e]),Number(i[0][a]))}),0<i.length&&addMarkerInfo(i,n,e,a,r,l))})},renderData=(a,e,t,r,l="",n)=>{const i=t;return document.querySelectorAll(`.${t[0]&&"undefined"!==t[0]?t[0].id:""}-placeholder`).forEach(e=>e.remove()),e.forEach((e,t)=>{document.createElement("div");replaceContentOfItem(a,e,i,r,t,l,n)})},addMarkerInfo=(e,l,n,i,s,d)=>{let o=[];e.map(e=>{const t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[n]),lng:Number(e[i])}),map:l});let a="<div>";e[s]&&(a+=`<h6>${e[s]}</h6>`),e[d]&&(a+=`<p>${e[d]}</p>`),a+="</div>";const r=new google.maps.InfoWindow({content:a});t.addListener("click",function(){clearInfoClickReference(o),r.open(t.get("map"),t),o[0]=r})})},replaceContentOfItem=(b,y,A,T,D="",C="",I)=>{Object.keys(A).forEach(async t=>{const e=A[t];var a=elementAttribute(e,"data-gjs");if(!["pagination","search-form","data-group-map"].includes(a)){const r=e.cloneNode(!0);var a=elementAttribute(r,"id");a&&(D||C)&&(D&&r.setAttribute("id",a+"-"+t+D+"-"+uuidv4()),C&&(a=elementAttribute(r,"id"),r.setAttribute("id",a+"-"+C))),applyUserDefinedStyles(e,r,I);const{itemData:l,collectionId:n}=await getPageItemData(),i="data-"+n,s="data-url-"+n;if(0<e.children.length){t=r.children,a=(updateChildrenIds(t,r,I),r.querySelectorAll("[data-text-content]"));const d=r.querySelectorAll("[data-img-src]");let e=r.querySelectorAll("[data-path-collection-name]");const o=r.querySelectorAll('[data-gjs="marketplace-form"]'),c=r.querySelectorAll("[role='progressbar']"),u=r.querySelectorAll("a, button"),m=r.querySelectorAll("[data-href-content]"),p=r.querySelectorAll("form"),g=r.querySelectorAll("[data-ref-field]"),v=r.querySelectorAll(`[${i}], [data-filter-id]`),f=(console.log("textContentElements test :>> ",v),r.querySelectorAll(`[${s}]`)),h=r.querySelectorAll('[data-text-content][data-field-type="file"][data-href-content]');g.forEach(e=>{replaceInnerGroup(b,y,e,I)}),d.forEach(e=>{e.closest("[data-ref-field]")||renderImageFromDB(y,e,I)}),Object.values(a).map(e=>{e.closest("[data-ref-field]")||replaceContentOfTextContent(y,e,I)}),c.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfProgressBarContent(y,e)}),e.forEach(e=>{e.closest("[data-ref-field]")||replaceHrefOfHyperLinks(y,e)}),u.forEach(e=>{e.closest("[data-ref-field]")||addItemUuidIntoButtonAndLink(b,y,e)}),m.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFieldURL(y,e)}),p.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFormElements(y,e)}),o.forEach(e=>{addValueToMarketplaceCheck(b,y,e)}),v.forEach(e=>{console.log("textElement test :>> ",e);var t,a=elementAttribute(e,i);console.log("BUG 1 ",a,e),a?(console.log("BUG 3"),t=elementAttribute(e,"data-field-type"),!(!(a=l[a]||"")||"large_text"!==t)&&htmlRegex.test(a)?e.innerHTML=a:e.textContent="boolean"===t?a?"Yes":"No":a):console.log("BUG 2"),e.style.display="block"}),f.forEach(e=>{var t=elementAttribute(e,s);const a=elementAttribute(e,s);t=a.replace(t,l[t]);e.setAttribute("href",t)}),h.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFileLinkElements(y,e)})}else replaceContentOfTextContent(y,r,I),renderImageFromDB(y,r,I),replaceHrefOfHyperLinks(y,r),replaceContentOfFieldURL(y,r),replaceContentOfFormElements(y,r);T.appendChild(r),addDynamicDataIntoFormElements(null,!1,T)}})},clearInfoClickReference=e=>{e.map(e=>{e.set("marker",null),e.close()})},applyUserDefinedStyles=(e,t,a)=>{var r=elementAttribute(e,"id"),l="#"+r,n=(elementAttribute(t,"id"),Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin)));for(let e=0;e<n.length;e++){var i=n[e].cssRules||n[e].rules;for(let e=0;e<i.length;e++){var s=i[e];if(s.selectorText===l){let t="";for(let e=0;e<s.style.length;e++)t+=`${s.style[e]}: ${s.style[s.style[e]]} !important;`;a.set(r,`{ ${t} }`)}}}},updateChildrenIds=(e,t,a)=>{var r;e[0].hasAttribute("id")&&(r=e[0].getAttribute("id"),applyUserDefinedStyles(e[0],t,a),e[0].setAttribute("id",r+"-"+uuidv4())),e[0].childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},replaceInnerGroup=(t,e,a,r)=>{const l=a.cloneNode(!0);a.innerHTML="";var n=elementAttribute(l,"data-ref-field");elementAttribute(l,"data-ref-collection");let i=n?parseValueFromData(e,n):[];i&&Array.isArray(i)?i.forEach(e=>{renderItemOfReferenceField(t,e,l,a,r)}):renderItemOfReferenceField(t,i,l,a,r)},renderImageFromDB=(a,r,l)=>{var n=elementAttribute(r,"data-img-src");elementAttribute(r,"data-field-type");if(n){let e=r.src,t=n?parseValueFromData(a,n):"";Array.isArray(t)&&(t=t[0]),renderImgContent?(a=r.cloneNode(!0),n=elementAttribute(r,"id")+"-"+uuidv4(),r.setAttribute("id",n),applyUserDefinedStyles(a,r,l)):renderImgContent=!0,t&&("object"==typeof t?(n=t.key,e=t.isExternalUrl?t.url:n?IMAGE_SERVER_URL+n:e):"string"==typeof t&&t.startsWith("http")&&(e=t),r.src=e)}},replaceContentOfTextContent=(t,a,r)=>{replaceTextContent?(n=a.cloneNode(!0),e=elementAttribute(a,"id"),a.setAttribute("id",e),applyUserDefinedStyles(n,a,r)):replaceTextContent=!0;let l=elementAttribute(a,"data-text-content");var e=elementAttribute(a,"data-field-type");if(l)if(l.includes('"')&&"functionType"in JSON.parse(l)){var n=getDerivedFieldData(l,t);/<\/?[a-z][\s\S]*>/i.test(n)?a.innerHTML=n:a.textContent=n}else{if("reference"===e||"multi_reference"===e||"belongsTo"===e){let e=(JSON.parse(elementAttribute(a,"metaData"))||{})["nestedFieldName"];e||(n=((r=t._$belongsToMetaData)?r.refCollection:{})["collectionField"],e=n||void 0),l.includes(".")||(l=l+"."+e)}r=parseValueFromData(t,l);if(r&&"large_text"===e)if(htmlRegex.test(r))return void(a.innerHTML=r);"boolean"===e?a.textContent=r?"Yes":"No":a.textContent=r}},replaceContentOfProgressBarContent=(e,t)=>{t=t.parentElement;const a=elementAttribute(t,"data-progress-now"),r=elementAttribute(t,"data-progress-min"),l=elementAttribute(t,"data-progress-max"),n=t.children[0];var i;a&&e[a]&&(a.includes('"')&&"functionType"in JSON.parse(a)?(i=getDerivedFieldData(a,e),t.setAttribute("data-progress-now",i),n.setAttribute("aria-valuenow",i),n.style.nowWidth=i+"%"):(t.setAttribute("data-progress-now",e[a]),n.setAttribute("aria-valuenow",e[a]),n.style.width=e[a]+"%")),r&&e[r]&&(r.includes('"')&&"functionType"in JSON.parse(r)?(i=getDerivedFieldData(r,e),t.setAttribute("data-progress-min",i),n.setAttribute("aria-valuemin",i),n.style.minWidth=i+"%"):(t.setAttribute("data-progress-min",e[r]),n.setAttribute("aria-valuemin",e[r]),n.style.minWidth=e[r]+"%")),l&&e[l]&&(l.includes('"')&&"functionType"in JSON.parse(l)?(i=getDerivedFieldData(l,e),t.setAttribute("data-progress-max",i),n.setAttribute("aria-valuemax",i),n.style.maxWidth=i+"%"):(t.setAttribute("data-progress-max",e[l]),n.setAttribute("aria-valuemax",e[l]),n.style.maxWidth=e[l]+"%"))},replaceHrefOfHyperLinks=async(a,r)=>{var l=elementAttribute(r,"data-path-field-name"),n=elementAttribute(r,"data-path-field-seo"),i=(elementAttribute(r,"id"),elementAttribute(r,"data-path-collection-item-id-from"));if(["pageCollection","session"].includes(i)&&(a="session"===i?(i=localStorage.getItem("user"))&&"undefined"!==i?JSON.parse(i):{}:(i=(await getPageItemData())["itemData"],i)),l){const s=elementAttribute(r,"href");let e=l?parseValueFromData(a,l):"",t=(e=(e=e&&e.length?e.split(", "):"")[0],s.replace(l,e));n&&(i=n?parseValueFromData(a,n):"",i=slugify(i),t=t.replace(n,i)),r.setAttribute("href",t)}},addItemUuidIntoButtonAndLink=(e,t,a)=>{a.setAttribute("data-item-id",t.uuid),a.setAttribute("data-collection-id",e);e=window.document.getElementById("snipcart");void 0!==e&&null!=e&&a.classList.contains("snipcart-add-item")&&loadSnipcartItemData(a,t)},replaceContentOfFieldURL=(e,t)=>{const a=elementAttribute(t,"data-href-content");elementAttribute(t,"id");var r=elementAttribute(t,"data-field-type");a&&"file"!==r&&(r=a.replace(a,parseValueFromData(e,a)),t.setAttribute("href",r))},replaceContentOfFormElements=(a,e)=>{const t=e.querySelectorAll("[data-form-element-data-group]");t.forEach(e=>{var t=elementAttribute(e,"data-form-element-data-group"),t=parseValueFromData(a,t);insertFormElementValue(t,e)})},addValueToMarketplaceCheck=(e,t,a)=>{var r=elementAttribute(a,"quantityfield"),l=elementAttribute(a,"pricefield"),n=elementAttribute(a,"namefield"),i=elementAttribute(a,"descriptionfield");a.elements["quantity-field"].value=r,a.elements["price-field"].value=l,a.elements.productId.value=t.uuid,a.elements.collectionName.value=e,a.elements["name-field"].value=n,a.elements["description-field"].value=i},updateInnerChildIds=(e,t,a)=>{var r;elementAttribute(e,"id")&&(r=elementAttribute(e,"id"),applyUserDefinedStyles(e,t,a),e.setAttribute("id",r+"-"+uuidv4())),e.childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},renderItemOfReferenceField=(e,t,a,r)=>{a=a.children;replaceContentOfItem(e,t,a,r,"","",stylesMap)},getDerivedFieldData=(e,t)=>{const a=JSON.parse(e);e=a.parentFieldName;let r="";return r=e?t[e].map(e=>prepareFunction(a,e)).join(", "):prepareFunction(a,t)},prepareFunction=(e,l)=>{let n,i,s,d,o,c,u,m,p,g,v="",f=[];var t=localStorage.getItem("user")?localStorage.getItem("user").replaceAll("'",'"'):"",a=t?JSON.parse(t):{};switch(e.args.forEach(e=>{const{name:t,key:a}=e;"formatType"===t?n=a:"restToLower"===t?i=a:"whitespace"===t?s=a:"type"===t?o=a:"noSplitopt"===t?d=a:"length"===t?c=a:"endopt"===t?u=a:"startLength"===t?startLength=a:"endLength"===t?endLength=a:"startString"===t?m=a:"endString"===t?p=a:"separator"===t?g=a:"expression"===t&&(v=a);let r=[];["formatType","restToLower","whitespace","type","noSplitopt","length","endopt","startLength","endLength","startString","endString","separator","expression"].includes(t)||(Array.isArray(a)?(a.forEach(e=>{r.push(l[e])}),f.push(r)):f.push(l[a]))}),e.functionType){case"CAPITALIZE":return capitalize(f[0],i);case"LOWER_CASE":return lowerCase(f[0]);case"UPPER_CASE":return upperCase(f[0]);case"SLUGIFY":return slugify(f[0]);case"TRIM":return trim(f[0],s,o);case"TITLE_CASE":return titleCase(f[0],d);case"TRUNCATE":return truncate(f[0],c,u);case"SUB_STRING":return substr(f[0],startLength,endLength);case"STRING_JOIN":return strJoin(f[0],g,m,p);case"CUSTOM_SENTENCE":return evaluateCustomSentence(v,l,a);case"ADDITION":return addition(n,{numbers:f[0]});case"AVERAGE":return average(n,{numbers:f[0]});case"MULTIPLY":return multiply(n,{numbers:f[0]});case"DIVIDE":return divide(n,{number1:f[0],number2:f[1]});case"CUSTOM_CALCULATION":return evaluateExpression(v,l,a,n);case"CUSTOM_JS_LOGIC":case"CUSTOM_JAVASCRIPT_LOGIC":return evaluateJSLogic(v,l,a);case"SUBSTRACTION":return substraction(n,{numbers1:f[0],numbers2:f[1]});case"COUNT":return count(f[0]);case"FORMAT_DATE":var r=+document.getElementById("project-timezone").innerText||0;return formatDate(n.replace(/#SPACE#/g," "),f[0],r);default:return""}};async function searchInDataGroup(e,t){e.replacedElement.innerHTML="";var t=t.target,{searchString:t,finderId:a,collectionName:r}=(e.searchString=convertQueryStringFromFormElements(t),e),r=await securedGetCall(`collection-table/${r}/finder/${a}/items/count?`+t),a=r?r._$isPrivateFilter:null;e.numberOfPages=getNumberOfPages(r.data,e.numberPerPage),e.currentPage=1,loadGroupData(e,a)}const convertQueryStringFromFormElements=e=>Object.values(e).map(e=>{if(e&&e.name&&e.value)return encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}).filter(Boolean).join("&");function nextDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage+=1,loadGroupData(e)}function firstDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=1,loadGroupData(e)}function lastDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=e.numberOfPages,loadGroupData(e)}function previousDataGroupPage(e){e.replacedElement.innerHTML="",--e.currentPage,loadGroupData(e)}function loadMoreRecords(e){e.currentPage+=1,loadGroupData(e)}const prepareItemDataAndExternalQueryParam=(e,a,r,l)=>(e&&0<e.length&&e.forEach(e=>{var t=l.getAttribute(e);t&&r?(t=r[t])&&(a+=`&${e}=`+t):console.log("I do not have page item param or param key :>> ",e)}),a),prepareItemDataAndExternalQueryParamForTable=(e,t,a,r)=>{var l=t.includes("?");let n="";return l||(t+="?"),e&&0<e.length&&e.forEach(e=>{var t=r.getAttribute(e);t&&a&&((t=a[t])&&(n+=`&${e}=`+t))}),t=l?""+t+n:""+t+n.substr(1,n.length+1)},addDataGroupMarkerInfo=(e,l,n,i,s,d)=>{let o=[];e.map(e=>{const t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[n]),lng:Number(e[i])}),map:l});let a="<div>";e[s]&&(a+=`<h6>${e[s]}</h6>`),e[d]&&(a+=`<p>${e[d]}</p>`),a+="</div>";const r=new google.maps.InfoWindow({content:a});t.addListener("click",function(){clearInfoClickReference(o),r.open(t.get("map"),t),o[0]=r})})};function nextDataTablePage(e){e.currentPage+=1,loadDataList(e)}async function searchInDataTable(e,t,a=""){void 0!==t&&(t=t.target,e.searchString=convertQueryStringFromFormElements(t)),void 0!==e.searchString&&e.searchString&&a?(a.startsWith("?")&&(a=a.replace("?","&")),e.searchString=e.searchString+"&"+e.searchString+a):void 0===e.searchString&&a&&(a.startsWith("?")&&(a=a.replace("?","")),e.searchString=a);const{dataTable:r,searchString:l,finderId:n,collectionName:i,tbodyElement:s}=e;t=r.querySelector("thead").rows[0].cells.length;if(validateDataTableProps(n,i,t,s)){var a=await securedGetCall(`collection-table/${i}/finder/${n}/items/count?`+l),d=a?a._$isPrivateFilter:null;if(0<a.data)e.numberOfPages=getNumberOfPages(a.data,e.numberPerPage),e.currentPage=1,loadDataList(e);else{if(d)return s.innerHTML=`<tr><td  class="text-center" colspan="${t}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,r);s.innerHTML=`<tr><td  class="text-center" colspan="${t}"></td></tr>`,validatePaginationButton(1,1,r)}}else validatePaginationButton(1,1,r)}const validateDataTableProps=(e,t,a,r,l)=>{let n=!0;return t||(l.innerHTML=`<tr><td  class="text-center" colspan="${r}"> Please select a valid collection</td></tr>`,n=!1),n};async function loadDataList(e){var{currentPage:t,numberPerPage:a,filteredItemsUrl:r,fieldName:l,searchString:n,externalQueryParamKeys:i,dataTable:s}=e;let d=r;l||(r=(await getPageItemData())["itemData"],l=(t-1)*a,d=d+`?offset=${l}&limit=`+a,d=prepareItemDataAndExternalQueryParamForTable(i,d,r,s),n&&(d+="&"+n)),await renderDataTable(d,e),validatePaginationButton(e.numberOfPages,e.currentPage,e.dataTable)}const renderDataTable=async(t,a)=>{const{columnsMap:r,firstRowElements:l,tbodyElement:n,itemIds:i,collectionName:s}=a;if(n){var d="";n.innerHTML="",addTablePlaceholder(a.numberPerPage||1,l,n);let e=[];r&&(e=i||(await securedGetCall(t)).data,d+=await createTableRecords(e,r,l,s),n.innerHTML=d)}for(var[e,o]of dataTableStylesMap)selectorExists(`[id^="${e}"]`)||(e=`*[id^="${e}"] `+o,addStyle(e))},createTableRecords=async function(e,l,n,i=""){if(!e||!Array.isArray(e))return"";e=e.map(async e=>{var t,e=await getTableColumns(e,l,n,i);const a="TR"===n.tagName?n:"";let r="";return a&&(t=a.cloneNode(!0),r=elementAttribute(a,"id"),applyUserDefinedStyles(t,a,dataTableStylesMap)),`<tr ${setIdAttribute(r)}>${e}</tr>`});return(await Promise.all(e)).join("")},selectorExists=t=>{var a=getAllSelectors();for(let e=0;e<a.length;e++)if(a[e]==t)return!0;return!1},addStyle=e=>{let t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},getTableColumns=async(i,s,d,o="")=>{var e=Object.keys(s).map(async t=>{var e=d.cells,e=Object.values(e).find(e=>elementAttribute(e,"data-selected-column")===t);const a=void 0!==e&&"TD"===e.tagName?e:"",r=void 0!==e&&"TH"===e.tagName?e:"";let l="";a?(n=a.cloneNode(!0),l=elementAttribute(a,"id"),applyUserDefinedStyles(n,a,dataTableStylesMap)):r&&(n=r.cloneNode(!0),elementAttribute(r,"id"),applyUserDefinedStyles(n,r,dataTableStylesMap));var n=e?e.children:"";return t.includes('"')&&"functionType"in JSON.parse(t)?(e=getDerivedFieldData(t,i),`<td ${setIdAttribute(l)}>${setColumnDataIntoHtmlElement(e,n[0])}</td>`):"boolean"===s[t]?t in i?(e=i[t]?"Yes":"No",`<td ${setIdAttribute(l)}>${setColumnDataIntoHtmlElement(e,n[0])}</td>`):`<td ${setIdAttribute(l)}>${setColumnDataIntoHtmlElement(null,n[0])}</td>`:"image"===s[t]||"file"===s[t]?renderFileColumnData(i,t,n[0]):"multi_image"===s[t]||"multi_file"===s[t]?renderMultiFileColumnData(i,t,n[0]):"updatedAt"===s[t]||"createdAt"===s[t]||"date"===s[t]?renderTimestampColumnData(i,t,n[0]):"object"==typeof s[t]?renderReferenceTypeData(i,s[t],t,n[0]):"action"===s[t]?`<td ${setIdAttribute(l)}>${renderActionColumnData(i,t,n,o)}</td>`:"large_text"===s[t]?renderTableLargeTextColumn(i,t,n[0],l):"action_select_checkbox_all"===s[t]?`<td ${setIdAttribute(l)}>${renderCheckboxColumnData(i,t,n,o)}</td>`:renderTableBodyColumn(i,t,n[0],l)});return(await Promise.all(e)).join("")},setIdAttribute=e=>e?`id=${e}-`+uuidv4():"",setColumnDataIntoHtmlElement=(e,t,a=!1)=>t?(setAttributeInColumnData(t),a?t.innerHTML=e||"":t.textContent=e||"",t.outerHTML):e||"",renderFileColumnData=(e,t,n)=>{const a=t?e[t]:"";let r="",l="",i="";if("object"!=typeof a||Array.isArray(a))a&&Array.isArray(a)&&(i=a.map(e=>{var t=e?e.isExternalUrl?e.url:"":e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"",a=n?n.tagName:"";if(a&&"IMG"===a){const r=n.cloneNode(!0);return t?r.src=t:r.src,r.outerHTML}{const l=document.createElement("a");return l.href=t,l.innerText=e||t,n?(n.innerHTML=l.outerHTML,n.outerHTML):l.outerHTML}}));else{"object"==typeof a?(e=a.key,r=a.isExternalUrl?a.url:e?IMAGE_SERVER_URL+e:imageSrcUrl,l=a.originalName):"string"==typeof a&&a.startsWith("http")&&(r=a,l=a);t=n?n.tagName:"";if(t&&"IMG"===t){const s=n.cloneNode(!0);s.src=r||s.src,i=[s.outerHTML]}else{const d=document.createElement("a");d.href=r||r,d.innerText=l||r,i=n?(n.innerHTML=d.outerHTML,[n.outerHTML]):[d.outerHTML]}}return`<td>${i?i.join(" "):""} </td>`},renderMultiFileColumnData=(e,t,n)=>{let a="";return`<td>${(a=e[t]&&Array.isArray(e[t])?e[t].map(e=>{var t=e&&e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"",a=n?n.tagName:"";if(a&&"IMG"===a){const r=n.cloneNode(!0);return t?r.src=t:r.src,r.outerHTML}{const l=document.createElement("a");return l.href=t,l.innerText=e||t,n?(n.innerHTML=l.outerHTML,n.outerHTML):l.outerHTML}}):a)?a.join(" "):""} </td>`},renderTimestampColumnData=(e,t,a)=>{e=e[t]?convertTimeStampToDate(e[t]):"";return`<td>${setColumnDataIntoHtmlElement(e,a)}</td>`},createFileAnchorTag=(e,t)=>{var a=e&&e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"";const r=document.createElement("a");return r.href=a,r.innerText=e||a,t?(t.innerHTML=r.outerHTML,t.outerHTML):r.outerHTML},renderReferenceTypeFileData=(e,a)=>{let t="";return e&&Array.isArray(e)?`<td>${(t=e.map(t=>{if(t&&Array.isArray(t)){let e=t.map(e=>createFileAnchorTag(e,a));return e.join(" ")}return createFileAnchorTag(t,a)}))?t.join(" "):""} </td>`:"<td></td>"},renderReferenceTypeData=(e,t,a,r)=>{let{nestedFieldName:l,fieldType:n,hasBelongsToParentData:i}=t.metaData||{};if(l||(s=((s=e._$belongsToMetaData)?s.refCollection:{})["collectionField"],l=s||void 0,"createdBy"===t.type&&(l="userName")),a.includes(".")||i||(a=a+"."+l),i&&t.metaData&&(e=t.metaData,a.includes("."))){const d=a.split("."),o=d.splice(1);a=o.join(".")}var s=parseValueFromData(e,a);return s&&"file"===n?renderReferenceTypeFileData(s,r):s?`<td>${setColumnDataIntoHtmlElement(s,r)}</td>`:"<td></td>"},renderLinkColumnData=(a,r,l="")=>{const n=r.cloneNode(!0);var i=elementAttribute(r,"id"),i=(i&&(i=i+"-"+a.uuid,n.setAttribute("id",i),applyUserDefinedStyles(r,n,dataTableStylesMap)),n.setAttribute("data-item-id",a.uuid),n.setAttribute("data-collection-item",JSON.stringify(a)),n.setAttribute("data-collection-id",l),window.document.getElementById("snipcart")),r=(void 0!==i&&null!=i&&n.classList.contains("snipcart-add-item")&&loadSnipcartItemData(n,a),elementAttribute(n,"data-path-field-name")),l=elementAttribute(n,"data-path-field-seo");if(r){const s=elementAttribute(n,"href");let e=r?parseValueFromData(a,r):"",t=(e=(e=e&&e.length?e.split(", "):"")[0],s.replace(r,e));l&&(i=l?parseValueFromData(a,l):"",i=slugify(i),t=t.replace(l,i)),n.setAttribute("href",t)}return n},renderCheckboxColumnData=(e,t,a,r="")=>{var l="action-select-item-"+e.uuid;return`<div data-gjs="checkbox-item">
  <input
    type="checkbox"
    value=""
    data-gjs="dt-item-check"
    id=${l}
    data-item-id=${e.uuid}
    data-collection-id=${r}
    />
  <label class="form-check-label" for=${l}></label>
</div>`},renderActionColumnData=(t,e,a,r="")=>{const l=document.createElement("div");return Object.values(a).map(e=>{["pageCollection","session"].includes(e.getAttribute("data-path-collection-item-id-from"))?l.appendChild(e.cloneNode(!0)):(e=renderLinkColumnData(t,e,r),l.appendChild(e))}),l.innerHTML},renderTableLargeTextColumn=(e,t,a,r)=>{var l=!!e[t]&&htmlRegex.test(e[t]),e=e[t]||"";return`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(e,a,l)}</td>`},renderTableBodyColumn=(e,t,a,r)=>{var l=a?.tagName,l=(l&&"A"===l&&!["pageCollection","session"].includes(element.getAttribute("data-path-collection-item-id-from"))&&(a=renderLinkColumnData(e,a)),e[t]||"");return`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(l,a)}</td>`},setAttributeInColumnData=e=>{var t=e.cloneNode(!0);let a=elementAttribute(e,"id");return a=a||uuidv4(),applyUserDefinedStyles(t,e,dataTableStylesMap),e.hasAttribute("data-org-id")?e.setAttribute("id",elementAttribute(e,"data-org-id")+"-"+uuidv4()):(e.setAttribute("id",a+"-"+uuidv4()),e.setAttribute("data-org-id",a)),e},loadDataTable=async(l,n,i)=>{const{dataTable:s,fieldName:t,externalQueryParamKeys:d}=i;var e=s.querySelector("thead").rows[0].cells.length;const o=s.querySelector("[data-js=table-body]");if(validateDataTableProps(l,n,t,e,o)){let a=0,r=!1;var c=(await getPageItemData())["itemData"];if(l){let e=`collection-table/${n}/finder/${l}/items/count`,t=(e=prepareItemDataAndExternalQueryParamForTable(d,e,c,s),await searchQueryStringFromUrl());"undefined"!=typeof searchString&&searchString?e=t?(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+"&"+searchString+t):e+"&"+searchString:t&&(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+=t);l=await securedGetCall(e);a=l.data,i.numberOfPages=getNumberOfPages(a,i.numberPerPage),r=l?l._$isPrivateFilter:null}else if(t){let e=parseValueFromData(c,t);e=Array.isArray(e)?e:0<Object.keys(e).length?[e]:[],a=e.length,i.numberOfPages=1,i.filteredItemsUrl=`collection-table/${n}/itemList`,i.itemIds=e}if(i.tbodyElement=o,await setTableMetaData(i,c,t),0<a){l=await searchQueryStringFromUrl();l?searchInDataTable(i,void 0,l):loadDataList(i)}else{if(r)return o.innerHTML=`<tr><td class="text-center" colspan="${e}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,s);o.innerHTML=`<tr class="no-record-data-table"><td class="text-center" colspan="${e}"></td></tr>`,validatePaginationButton(1,1,s)}addDataTableDataToMap(i,i.dataTable)}else validatePaginationButton(1,1,s)},addTablePlaceholder=(t,e,a)=>{var r=localStorage.getItem("loadingIconKey");if("PLACEHOLDER"===r){var l=e.cells.length;for(let e=0;e<t;e++){const i=a.insertRow();for(let e=0;e<l;e++){const s=i.insertCell();s.innerHTML='<div class="drapcode-item-table"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-12"></div></div></div></div>'}}}else{var n=e.cells.length;const d=a.insertRow();for(let e=0;e<n;e++){const o=d.insertCell();o.innerHTML="PLAIN_SPINNER"===r?'<div class="drapcode-spinner-plane drapcode-item-table"></div>':"CHASE_SPINNER"===r?'<div class="sk-chase drapcode-item-table"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>':"BAR_SPINNER"===r?'<div class="drapcode-spinner-bar drapcode-item-table"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>':"DOT_SPINNER"===r?'<div class="drapcode-spinner-dot drapcode-item-table"><div class="dot1"></div><div class="dot2"></div></div>':"FADING_CIRCLE_SPINNER"===r?'<div class="sk-fading-circle drapcode-item-table"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>':"BOUNCE_SPINNER"===r?'<div class="drapcode-spinner-bounce drapcode-item-table"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>':""}}},setTableMetaData=async(e,t={},a="")=>{const{dataTable:r,tbodyElement:l}=e;var n=l.rows[0].cloneNode(!0);e.firstRowElements=n,e.columnsMap=getColumnsMetaData(r,t,a)},getColumnsMetaData=(e,l={},n="")=>{let i=[];var e=e.querySelector("[data-custom-js-row=collection-row]");return e&&(e=e?e.cells:[],Object.values(e).map(t=>{let a=elementAttribute(t,"data-selected-column");a.includes('"')&&(a=a.split("'").join('"'));var r=elementAttribute(t,"type");if(a&&("reference"===(i[a]=r)||"multi_reference"===r||"createdBy"===r||"belongsTo"===r)){let e=elementAttribute(t,"metadata");!(e="createdBy"!==r||e?e:null)&&l&&n&&l[n]?(l.hasBelongsToParentData=!0,i[a]={metaData:l,type:r}):i[a]={metaData:JSON.parse(e),type:r}}})),i},addDataTableDataToMap=async(e,t)=>{dataTablePaginationDataMap.set("ptdata_"+t.id,e)};function firstDataTablePage(e){e.currentPage=1,loadDataList(e)}function lastDataTablePage(e){e.currentPage=e.numberOfPages,loadDataList(e)}function previousDataTablePage(e){--e.currentPage,loadDataList(e)}const getAllSelectors=()=>{let t=[];var a=Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin));for(let e=0;e<a.length;e++){var r,l=a[e].rules||a[e].cssRules;for(r in l)"string"==typeof l[r].selectorText&&t.push(l[r].selectorText)}return t},elementAttribute=(e,t)=>e.getAttribute(t),renderLineChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const l=elementAttribute(e,"data-series"),n=elementAttribute(e,"data-xaxis");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[l]),d.push(e[n])});a={series:[{name:"Desktops",data:s}],chart:{height:t.chartHeight,type:"line",zoom:{enabled:t.chartZoom}},dataLabels:{enabled:t.chartDataLabel},stroke:{curve:t.strokeCurve||"straight"},title:{text:t.title||"-",align:"left"},grid:{row:{colors:["#f3f3f3","transparent"],opacity:.5}},xaxis:{categories:d}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderAreaChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const l=elementAttribute(e,"data-series"),n=elementAttribute(e,"data-xaxis");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[l]),d.push(e[n])});a={series:[{name:"STOCK ABC",data:s}],chart:{type:"area",height:t.chartHeight,zoom:{enabled:t.chartZoom}},dataLabels:{enabled:t.chartDataLabel},stroke:{curve:t.strokeCurve||"straight"},title:{text:t.title||"-",align:"left"},subtitle:{text:t.subtitle||"-",align:"left"},labels:d,xaxis:{type:"datetime"},yaxis:{opposite:!0},legend:{horizontalAlign:"left"}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderCircularGaugeChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const l=elementAttribute(e,"data-series"),n=elementAttribute(e,"data-labels");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[l]),d.push(e[n])});a={series:s,chart:{height:t.chartHeight,type:"radialBar"},plotOptions:{radialBar:{hollow:{size:`${t.hollowSize||"70"}%`}}},stroke:{dashArray:t.strokeDashArray||0,lineCap:""+(t.strokeLineCap||"round")},labels:d};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderHeatMapChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const l=elementAttribute(e,"data-series-name"),n=elementAttribute(e,"data-series-data-x"),i=elementAttribute(e,"data-series-data-y");if(a&&r){const s=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<s.data.length){const d=[];s.data.map(t=>{const e=d.find(e=>e.name===t[l]);e?e.data.push({x:t[n],y:t[i]}):d.push({name:t[l],data:[{x:t[n],y:t[i]}]})});a={series:d,chart:{height:t.chartHeight,type:"heatmap"},dataLabels:{enabled:!1},colors:["#008FFB"],title:{text:t.chartTitle||"-"}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderPieChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const l=elementAttribute(e,"data-series"),n=elementAttribute(e,"data-labels");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[l]),d.push(e[n])});a={series:s,chart:{width:t.chartWidth,type:t.chartType||"pie"},labels:d};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderAutoComplete=async(a,r,l,n)=>{if(r&&l){const i=(await securedGetCall(`collection-table/${r}/finder/${l}/items`))["data"];let t=[],e="Search...";0<i.length&&i.forEach(e=>{e&&(0<Object.keys(e).length?t.push(e[n]):t.push(e))}),0===t.length&&(e="No Data");const s=new autoComplete({selector:"#"+a.id,placeHolder:e,data:{src:t},resultItem:{highlight:!0},events:{input:{selection:e=>{e=e.detail.selection.value;s.input.value=e}}}})}},loadDataMapItems=async(e,t,a,r)=>{var l=elementAttribute(r,"data-map-lat"),n=elementAttribute(r,"data-map-long"),i=elementAttribute(r,"data-map-header"),s=elementAttribute(r,"data-map-description");r.innerHTML=`<div id="map-${r.id}" class="map"></div> <style>.map{
      height:100%;width:100%;
  }</style>`,t&&e&&(t=await securedGetCall(`collection-table/${t}/finder/${e}/items`),e=new google.maps.Map(document.getElementById("map-"+r.id),{zoom:Number(a),center:new google.maps.LatLng(Number(t.data[0][l]),Number(t.data[0][n]))}),0<t.data.length&&addMarkerInfo(t.data,e,l,n,i,s))},renderImageColumnData=(e,t,a)=>{const r=t?e[t]:"";let l="",n="";"object"==typeof r?(l=IMAGE_SERVER_URL+r.key,n=r.originalName):"string"==typeof r&&r.startsWith("http")&&(l=r,n=r);e=a?a.tagName:"";if(e&&"IMG"===e){const i=a.cloneNode(!0);return i.src=l||i.src,`<td>${i.outerHTML}</td>`}{const s=document.createElement("a");return s.href=l||l,s.innerText=n||l,a?(a.innerHTML=s.outerHTML,`<td>${a.outerHTML}</td>`):`<td>${s.outerHTML}</td>`}};
//# sourceMappingURL=dataLoader.js.map