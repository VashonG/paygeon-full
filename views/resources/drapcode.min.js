const DATE_REGEX=/^[12]\d{3}(-(0[1-9]|1[0-2])(-(0[1-9]|[12][0-9]|3[01]))?)(T| )?(([01][0-9]|2[0-3]):[0-5]\d(:[0-5]\d(\.\d+)?)?(Z|[+-]\d{2}:\d{2})?)?$/,htmlRegex=/<(br|basefont|hr|input|source|frame|param|area|meta|!--|col|link|option|base|img|wbr|!DOCTYPE).*?>|<(a|abbr|acronym|address|applet|article|aside|audio|b|bdi|bdo|big|blockquote|body|button|canvas|caption|center|cite|code|colgroup|command|datalist|dd|del|details|dfn|dialog|dir|div|dl|dt|em|embed|fieldset|figcaption|figure|font|footer|form|frameset|head|header|hgroup|h1|h2|h3|h4|h5|h6|html|i|iframe|ins|kbd|keygen|label|legend|li|map|mark|menu|meter|nav|noframes|noscript|object|ol|optgroup|output|p|pre|progress|q|rp|rt|ruby|s|samp|script|section|select|small|span|strike|strong|style|sub|summary|sup|table|tbody|td|textarea|tfoot|th|thead|time|title|tr|track|tt|u|ul|var|video).*?<\/\2>/i,EQUALS="EQUALS",IS_NOT_NULL="IS_NOT_NULL",IS_NULL="IS_NULL",LIKE="LIKE",IN_LIST="IN_LIST",NOT_IN_LIST="NOT_IN_LIST",LESS_THAN="LESS_THAN",GREATER_THAN="GREATER_THAN",LESS_THAN_EQUALS_TO="LESS_THAN_EQUALS_TO",GREATER_THAN_EQUALS_TO="GREATER_THAN_EQUALS_TO",BETWEEN="BETWEEN",NOT_EQUAL="NOT_EQUAL",CURRENT_USER="currentLoggedInUser",CURRENT_USER_ROLE="currentLoggedInUserRole",CURRENT_TIME="CURRENT_TIME",CURRENT_DATE="currentDate",CURRENT_DATE_TIME="currentDateTime",COLLECTION="collection",IS_LOGGED_IN="IS_LOGGED_IN",IS_NOT_LOGGED_IN="IS_NOT_LOGGED_IN",COLLECTION_USER="user",LOGIN_WITH_TOKEN="LOGIN_WITH_TOKEN",LOGIN_WITH_FIREBASE="LOGIN_WITH_FIREBASE",LOGIN_WITH_XANO="LOGIN_WITH_XANO",LOGIN_WITH_BACKENDLESS="LOGIN_WITH_BACKENDLESS",LOGIN_USER="LOGIN_USER",capitalize=function(e,t){return v.capitalize(e,"TRUE"===t)},lowerCase=function(e){return v.lowerCase(e)},upperCase=function(e){return v.upperCase(e)},slugify=function(e){return v.slugify(e)},trim=function(e,t,a){return"LEFT"===a?v.trimLeft(e,t):"RIGHT"===a?v.trimRight(e,t):v.trim(e,t)},titleCase=function(e,t){return v.titleCase(e,[t])},truncate=function(e,t,a){return v.truncate(e,t,a)},substr=function(e,t,a){return v.substr(e,t,a)},strJoin=function(e,t,a,r){return t=t?t.replace(/##@@##@@##/g," "):" ",e=(e=Array.isArray(e)?e:[e]).filter(Boolean),""+(a?a.replace(/##@@##@@##/g," ")+t:"")+e.join(t)+(r?t+r.replace(/##@@##@@##/g," "):"")},evaluateCustomSentence=function(e,t,a){return e=e?getSpecialCharectorReplacedExpression(e):" ",replaceFieldsValueIntoExpression(e,t,a)},getSpecialCharectorReplacedExpression=e=>e.replace(/##@@##@@##/g," ").replace(/##@@##@@@@/g,">").replace(/@@@@##@@@@/g,"<").replace(/U\+000A/g,"<br/>").replace(/U\+0022/g,'"').replace(/U\+0027/g,"'"),addition=function(e,{numbers:t}){try{return numeral(math.add(...t)).format(e||"00.00")}catch(e){return""}},average=function(e,{numbers:t}){try{return numeral(math.mean(...t)).format(e||"00.00")}catch(e){return""}},multiply=function(e,{numbers:t}){try{return numeral(math.multiply(...t)).format(e||"00.00")}catch(e){return""}},divide=function(e,{number1:t,number2:a}){try{return numeral(math.divide(t,a)).format(e||"00.00")}catch(e){return""}},evaluateExpression=function(e,t,a,r){e=e?getSpecialCharectorReplacedExpression(e):" ";e=replaceFieldsValueIntoExpression(e,t,a);try{return numeral(math.evaluate(e)).format(r||"00.00")}catch(e){return""}},evaluateJSLogic=function(e,t,a){e=e?getSpecialCharectorReplacedExpression(e):" ";const r=replaceFieldsValueIntoExpression(e,t,a);try{const o=new Function(r.toString());return o()}catch(e){return""}},replaceFieldsValueIntoExpression=function(o,s,n){const e=o.match(/{{(.*?)}}/g)?.map(e=>e.replace(/{{(.*?)}}/g,"$1"));return e?.forEach((e,t)=>{var a=`{{${e}}}`;let r="";(e=v.trim(e)).includes("current_user")?(e=e.replace("current_user.",""),0<Object.keys(n).length&&(r=parseValueFromData(n,e))):0<Object.keys(s).length&&(r=parseValueFromData(s,e)),o=replaceValueInExpression(a,r,o)}),o},replaceValueInExpression=function(e,t,a){e=new RegExp(e,"ig");return a.replace(e,t=t||"")},substraction=function(e,{numbers1:t,numbers2:a}){try{var r=Array.isArray(t)?math.add(...t):t,o=Array.isArray(a)?math.add(...a):a;return numeral(math.subtract(r,o)).format(e||"00.00")}catch(e){return""}},count=function(e){return e.length},formatDate=function(e,t,a){return"FROM_NOW"===e?t?moment(t).utcOffset(a).fromNow():"":t?moment(t).utcOffset(a).format(e):""},parseValueFromData=(e,r)=>{let o="";var t;if(r.includes("functionType"))return r=r.replaceAll("'",'"'),t=JSON.parse(""+r),o=(o=prepareFunction(t,e))&&"undefined"!=o&&"undefined"!==o?o:"";if(r&&r.includes(".")){var s=r.split(".");let t,a=e||"";for(let e=0;e<s.length;e++)t=s[e],Array.isArray(a)&&(a[t]=a.map(e=>{if(e[t])return e[t]})),a[t]||(a[t]=""),a=a[t];o=a||"",Array.isArray(o)&&(o=o.filter(()=>!0))}else(o=e?e[r]:"")&&"undefined"!=o&&"undefined"!==o||(o="");return o&&Array.isArray(o)&&1===o.length?o[0]:o&&Array.isArray(o)&&"string"==typeof o[0]?o.join(", "):o},getIframeVideoUrlForYoutubeOrVimeo=(e,t,a)=>{var r;return"youtube"===a||"youtube-nocookie"===a?(r=t.match(/^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/))&&r[2]?"youtube"===a?e.slice(0,30)+r[2]+e.slice(30):e.slice(0,39)+r[2]+e.slice(39):"":"vimeo"===a?(r=t.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/))&&r[3]?e.slice(0,31)+r[3]+e.slice(31):"":void 0},createLoggerDateFormat=()=>moment().format("YYYY-MM-DD"),createLogsDateFormat=()=>moment().format("YYYY-MM-DDTHH:mm:ss.SSS"),nextDayDate=e=>(e=new Date(e),moment(e).add(1,"days").format("YYYY-MM-DD")),convertTimeStampToDate=e=>{var t=+document.getElementById("project-timezone").innerText||0;return e?moment(e).utcOffset(t).format(10<e.length?"Do MMM YYYY, h:mm a":"Do MMM YYYY"):""},getPageItemData=async()=>{let t={};var a=window.location.search,r=window.location.pathname.split("/"),o=r[r.length-2];let s=r[r.length-1];s&&s.includes("_")&&(s=s.split("_")[1]);const e=new URLSearchParams(a);e.get("c"),e.get("i"),window.localStorage,window.sessionStorage;if(o&&s){let e={};"reset-password"!==o&&(r=`items/${o}/item/`+s,a=await securedGetCall(r),e=a?a.data:{}),t={itemData:e,collectionId:o,collectionItemId:s}}return t},searchQueryStringFromUrl=async function(){return new URL(window.location.href).search},isLoggedInUser=()=>{return!!localStorage.getItem("user")},fetchLoggedInUser=()=>{return localStorage.getItem("user")},isLoggedInUserRole=e=>{return localStorage.getItem("role")===e},searchQueryFromURL=async function(){var t=await searchQueryStringFromUrl();if(0<t.length){const r=new URLSearchParams(t);let e=document.querySelectorAll("[data-gjs=page-search-form]");e&&e.forEach(e=>{for(var t of r.keys()){const a=e.querySelector("[name="+t+"]");a&&(a.value=r.get(t))}})}},renderAutoCompleteInForm=async(a,r,o,s)=>{if(r&&o){r=`collection-table/${r}/finder/${o}/items`;const n=(await securedGetCall(r))["data"];let t=[],e="Search...";0<n.length&&n.forEach(e=>{e&&(0<Object.keys(e).length?t.push(e[s]):t.push(e))}),0===t.length&&(e="No Data");const l=new autoComplete({selector:"#"+a.id,placeHolder:e,data:{src:t},resultItem:{highlight:!0},events:{input:{selection:e=>{e=e.detail.selection.value;l.input.value=e}}}})}},loadDynamicFilterDataIntoElements=(e=!1)=>{let t=window.document.querySelectorAll("[data-filter-collection]");(t=e?document.querySelectorAll("[id^=modal-container] [data-filter-collection]"):t).forEach(async e=>{var t=e.getAttribute("data-filter-id"),t=`collection-table/${e.getAttribute("data-filter-collection")}/finder/${t}/items/`,t=await securedGetCall(t),a=t.data;t&&"object"!=typeof a&&(e.textContent=a,e.style.display="block")})},loadDynamicSelectOptions=async(e,t,a,r,o=!1,s=null)=>{t=t?JSON.parse(t):"";e.getAttribute("data-form-element-collection");["static_option","dynamic_option","reference","multi_reference","belongsTo"].includes(t.type)&&(t.isMultiSelect&&(e.setAttribute("name",t.fieldName+"[]"),e.setAttribute("multiple","multiple")),e.setAttribute("placeholder","Select "+t.fieldTitle.en)),t&&("static_option"===t.type?r?await applyWorkflowForStaticOptions(e,r,t,s,o):staticOptions(t,e,o,s):["dynamic_option","reference","multi_reference","belongsTo"].includes(t.type)?referenceAndDynamicOptions(t,e,a,o,s):["template_option"].includes(t.type)&&tenantTemplateOptions(t,e))},loadDynamicSelectOptionsForRadio=async(e,t,a,r,o=!1,s=null)=>{t=t?JSON.parse(t):"";console.log(":::::::::::"),console.log("::::::field:::::",t),console.log("::::::select:::::",e),console.log(":::::::::::"),t&&("static_option"===t.type?r?await applyWorkflowForStaticOptions(e,r,t,s,o):staticOptionsForRadio(t,e,o,s):["dynamic_option","reference","multi_reference","belongsTo"].includes(t.type)&&referenceAndDynamicOptions(t,e,a,o,s,"",!0))},loadSearchFormDynamicSelectOptions=(e,t,a)=>{t=t?JSON.parse(t):"";["static_option","dynamic_option","reference","multi_reference","belongsTo"].includes(t.type)&&e.setAttribute("placeholder","Select "+t.fieldTitle.en),t?"static_option"===t.type?staticOptions(t,e):["dynamic_option","reference","multi_reference","belongsTo"].includes(t.type)&&referenceAndDynamicOptions(t,e,a):e&&0<e.length&&$("#"+e.id).select2({selectionCssClass:":all:",width:"resolve"}).val("").trigger("change")},staticOptionsForRadio=(e,n,t=0,a,r=null)=>{console.log("::::staticOptionsForRadio::::::"),console.log("::::staticOptionsForRadio::::::"),console.log("::::::::::");let o=[`<option value="">- Select ${e.fieldTitle.en} -</option>`];if(r){const{workflowRule:s,itemCurrentValue:l}=r;l&&(o=o.concat(`<option value="${l}">${l}</option>`)),s&&(o=o.concat(s.nextValue.map(e=>`<option value="${e.label}">${e.label}</option>`)))}else{const i=document.createElement("div");r=n.parentNode.getAttribute("id");const c=r||"radio";console.log(c),e.staticOptions.map(e=>{console.log("::item::",e);const t=n.parentNode.cloneNode(!0),a=(t.setAttribute("id",c+"-"+e),console.log("cloneParentElement",t),t.getElementsByTagName("input")),r=(console.log("radioInputElement",a),t.getElementsByTagName("label"));console.log("labelElement",r);var o=a[0].getAttribute("id"),s=r[0].getAttribute("id"),s=""===s&&s?s:"label-"+o+"-"+e;a[0].setAttribute("value",e),a[0].setAttribute("id",o+"-"+e),r[0].setAttribute("for",o+"-"+e),r[0].setAttribute("id",""+s),r[0].innerText=e,i.appendChild(t)}),console.log("wrop elemt",i),console.log("wrop elemt",i.innerHTML),n.parentNode.replaceWith(...i.childNodes)}},staticOptions=(e,t,a=!1,r=null,o=null)=>{let s=[`<option value="">- Select ${e.fieldTitle.en} -</option>`];if(o){const{workflowRule:n,itemCurrentValue:l}=o;l&&(s=s.concat(`<option value="${l}">${l}</option>`)),n&&(s=s.concat(n.nextValue.map(e=>`<option value="${e.label}">${e.label}</option>`)))}else s=s.concat(e.staticOptions.map(e=>`<option value="${e}">${e}</option>`));t.innerHTML=s.join(""),setPredefinedValuesInSelect(t,e,a,r)},addDynamicDataIntoFormElements=async(s=null,t=!1,e="")=>{if(!s){let e={};e=t?await getModalItemData():await getPageItemData(),s=e.itemData}var a=localStorage.getItem("user")?localStorage.getItem("user").replaceAll("'",'"'):"";const n=a?JSON.parse(a):"",l=JSON.parse(sessionStorage.getItem("previousActionResponse")),i=JSON.parse(sessionStorage.getItem("previousActionFormData"));let r="";(r=t?(e||document).querySelectorAll("[id^=modal-container] form"):(e||document).querySelectorAll("form")).forEach(e=>{const t=e.querySelectorAll("[data-form-element-collection]"),a=e.querySelectorAll("[data-form-element-session]"),r=e.querySelectorAll("[data-form-element-previous-action-response]"),o=e.querySelectorAll("[data-form-element-previous-action-formdata]");a.forEach(e=>{var t=e.getAttribute("data-form-element-session"),t=n&&t?parseValueFromData(n,t):"";insertFormElementValue(t,e)}),t.forEach(e=>{var t=e.getAttribute("data-form-element-collection"),t=s&&t?parseValueFromData(s,t):"";void 0!==t&&"undefined"!==t&&insertFormElementValue(t,e)}),r.forEach(t=>{const e=t.getAttribute("data-form-element-previous-action-response"),a=e?e.trim().split("|"):"";let r=!0;0<a.length&&a.forEach(e=>{e&&r&&((e=l&&e?parseValueFromData(l,e.trim()):"")&&void 0!==e&&"undefined"!==e&&""!==e&&" "!==e&&"null"!==e&&(r=!1,insertFormElementValue(e,t)))})}),o.forEach(t=>{const e=t.getAttribute("data-form-element-previous-action-formdata"),a=e?e.trim().split("|"):"";let r=!0;0<a.length&&a.forEach(e=>{e&&r&&((e=i&&e?parseValueFromData(i,e.trim()):"")&&void 0!==e&&"undefined"!==e&&""!==e&&" "!==e&&"null"!==e&&(r=!1,insertFormElementValue(e,t)))})})})},insertFormElementValue=(t,a)=>{if(isCheckbox(a))t&&(a.checked=!0);else if("file"===a.type){let e=a.parentElement.getElementsByClassName("file-list-display")[0];if(t&&"object"==typeof t&&(e.innerHTML=t.originalName),t&&Array.isArray(t)){const o=t.map(e=>e.originalName||"");e.innerHTML=o.join(",")}const r=a.parentElement.querySelector(`input[name="${a.name}"][type='hidden']`);r.value="object"==typeof t?JSON.stringify(t):""}else"datetime-local"===a.type?a.value=t?timestampToDatetimeInputString(new Date(t)):"":"datetime-local"===$(a).attr("flat-picker-date-type")?a.value=t?flatpickr.formatDate(new Date(t),"Y-m-d h:i K"):"":"SELECT"!==a.tagName&&("TEXTAREA"===a.tagName&&a.hasAttribute("data-show-editor")?$(a).summernote("code",t):"tel"===$(a).attr("type")?$(a).intlTelInput("setNumber",t):a.value=t=t&&"undefined"!=t&&"undefined"!==t?t:"")},collectionFormDetailForUpdate=(e,t)=>{e.method="put",e.setAttribute("action",e.getAttribute("action")+"/"+t.uuid)},isCheckbox=e=>"checkbox"===e.type,isMultiSelect=e=>e.options&&e.multiple,timestampToDatetimeInputString=e=>{const t=new Date(e+_getTimeZoneOffsetInMs());return t.toISOString().slice(0,19)},applyWorkflowForStaticOptions=async(e,r,t,a,o)=>{let s,n={},l=extractCollectionAndItemIdFromPath()["collectionId"];var i=await getPageItemData();let c=i.itemData;i.collectionItemId;i=`collection-details/${l=(l=i.collectionId)||e.closest("form").getAttribute("data-form-collection")}/name`;await publicGetCall(i).then(e=>{if(e.data&&e.data.workflows){const a=e.data["workflows"];var t;(s=a.filter(e=>e.uuid===r)[0])&&(e=(n.selectedWorkflow=s)["workflowRules"],(t=c&&c[s.keyField.value]?c[s.keyField.value].join(""):"")?fetchWorkflowRuleForItemValue(n,e,t):fetchWorkflowRuleForEmptyItemValue(n,e),n.itemCurrentValue=t)}}),staticOptions(t,e,o,a,n)},fetchWorkflowRuleForItemValue=(e,t,a)=>{e.workflowRule=t.filter(e=>e.currentValue&&e.currentValue.label===a&&e.role&&isLoggedInUserRole(""+e.role.value))[0],e.workflowRule||(e.workflowRule=t.filter(e=>!e.role&&e.currentValue&&e.currentValue.label===a)[0])},fetchWorkflowRuleForEmptyItemValue=(e,t)=>{e.workflowRule=t.filter(e=>!e.currentValue&&e.role&&isLoggedInUserRole(""+e.role.value))[0],e.workflowRule||(e.workflowRule=t.filter(e=>!e.currentValue&&!e.role)[0])},extractCollectionAndItemIdFromPath=()=>{let e="";var t=window.location.pathname.split("/"),a=t[t.length-2];return{collectionItemId:e=(e=t[t.length-1])&&e.includes("_")?e.split("_")[1]:e,collectionId:a}};function _getTimeZoneOffsetInMs(){return-60*(new Date).getTimezoneOffset()*1e3}const setPredefinedValuesInSelect=async(e,t,a=!1,r=null)=>{let o="";if(e.getAttribute("data-form-element-collection")){let e={};a=(e=a?await getModalItemData(r):await getPageItemData()).itemData;a&&(o=parseValueFromData(a,t.fieldName),["reference","multi_reference","belongsTo"].includes(t.type)?Array.isArray(o)?o=o?o.map(e=>e.uuid):[]:"object"==typeof o&&(o=o?o.uuid:""):"static_option"!==t.type&&"dynamic_option"!==t.type||t.isMultiSelect&&(o=o&&0<o.length?o.split(", "):[]))}$("#"+e.id).select2({selectionCssClass:":all:",width:"resolve"}).val(o).trigger("change")},dependentDropDownPopulateOnChange=async e=>{console.log("dependentDropDownPopulateOnChange",e);var{element:e,parameters:t}=e,{valuesToChangeElementName:t,field:a}=t,t=(console.log("element ",e.name),console.log("element ",e.value),JSON.parse(t)),r=t.fieldName,o=(console.log(":::::::valuesToChangeFieldName:::",r),$(e).closest("form"));console.log(":::::collectionFormOfElement:::",o);const s=$(o[0]).find(`select[name='${r}[]']`)[0]||$(o[0]).find(`select[name='${r}']`)[0];console.log(s);o=s.getAttribute("data-select-finder-id"),console.log(o),console.log(o),r=a+"="+e.value;console.log("queryParams",r),referenceAndDynamicOptions(t,s,o,!1,null,r,!1,!e.value)},referenceAndDynamicOptions=(t,a,e,r=!1,o=null,s="",n=!1,l=!1)=>{let i="";i=e&&s?`collection-table/${t.refCollection.collectionName}/finder/${e}/items/?`+s:e?`collection-table/${t.refCollection.collectionName}/finder/${e}/items/`:`collection-table/${t.refCollection.collectionName}/items/`,console.log(i),publicGetCall(i).then(e=>{console.log(":isRadioType::::::",n),n?referenceOptionsForRadio(a,t,e.data):(a.innerHTML=referenceOptions(t,l?[]:e.data),setPredefinedValuesInSelect(a,t,r,o))})},referenceOptionsForRadio=(l,i,e)=>{const c=document.createElement("div"),u=l.parentNode.getAttribute("id");console.log(u),e.map(e=>{console.log("::item::",e);const t=l.parentNode.cloneNode(!0),a=(t.setAttribute("id",u+"-"+e.uuid),console.log("cloneParentElement",t),t.getElementsByTagName("input")),r=(console.log("radioInputElement",a),t.getElementsByTagName("label"));console.log("labelElement",r);var o=a[0].getAttribute("id"),s=r[0].getAttribute("id"),n=e[i.refCollection.collectionField];console.log("::::::::itemValue",n),"dynamic_option"===i.type?a[0].setAttribute("value",n):a[0].setAttribute("value",e.uuid),a[0].setAttribute("id",o+"-"+e.uuid),r[0].setAttribute("for",o+"-"+e.uuid),r[0].setAttribute("id",s+"-"+e.uuid),r[0].innerText=n,c.appendChild(t)}),console.log("wrop elemt",c),console.log("wrop elemt",c.innerHTML),l.parentNode.replaceWith(...c.childNodes)},referenceOptions=(a,e)=>{let t=[`<option value="">- Select ${a.fieldTitle.en} -</option>`];return(t=t.concat(Array.isArray(e)?e.map(e=>{var t=e[a.refCollection.collectionField],e="dynamic_option"===a.type?t:e.uuid;if(t&&e)return`<option value="${e}">${t}</option>`}):"")).filter(()=>!0).join("")},tenantTemplateOptions=(t,a)=>{publicGetCall("projects/templates/").then(e=>{a.innerHTML=templateOptions(t,e.data),$("#"+a.id).select2({selectionCssClass:":all:",width:"resolve"}).val("").trigger("change")})},templateOptions=(e,t)=>{let a=[`<option value="">- Select ${e.fieldTitle.en} -</option>`];return(a=a.concat(Array.isArray(t)?t.map(e=>{var t=e.name,e=e.uuid;if(t&&e)return`<option value="${e}">${t}</option>`}):"")).filter(()=>!0).join("")},saveTenantTemplate=async e=>{let t,a,r;e&&(t=e.target||e.srcElement,a=e.currentTarget,e.preventDefault(),r=t.id?$("#"+t.id):"");var o=isLoggedInUser()?JSON.parse(fetchLoggedInUser()):"",e=!e||"submit"!==e.type||r&&r.valid()&&0===r.validate().pendingRequest&&o&&0<o.tenantId.length;let s,n,l=(r&&(s=r.find(":button[type=submit]"),n=s.html()),{});if(e){s&&s.prop("disabled",!0),s&&s.html("Submitting...");const c=await serializeFormData(a.elements);c.tenants=[...o.tenantId];try{var i=await unSecuredPostCall(c,"projects/templates/create");l.data=i,l.status="success",s&&s.prop("disabled",!1),s&&s.html(n),resetCollectionForm(a),toastr.success("Created Template Successfully.","Success!")}catch(e){console.error("error",e),s&&s.prop("disabled",!1),s&&s.html(n),e.response&&(l.data=e.response,l.status="error",toastr.error(e.response.data.message,"Failed!"))}}else console.info("I am submit event and not valid"),toastr.error("You are not authorized to submit form.","Submission Denied!"),s&&s.prop("disabled",!1),s&&s.html(n);return l},replaceContentOfFileLinkElements=(e,r,t=null)=>{let a;a=t?r.getAttribute(t):r.getAttribute("data-text-content");var o,t=r.getAttribute("data-field-type");if(a){const s=parseValueFromData(e,a);"file"===t&&(o=t=e="","object"!=typeof s||Array.isArray(s)?s&&Array.isArray(s)&&(o=s.map(e=>{var t=e&&e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"";const a=document.createElement("a");return a.href=t,a.innerText=e||t,a.id=r.id,a.classList=r.classList,a}),r.replaceWith(...o)):(e=IMAGE_SERVER_URL+s.key,t=s.originalName,r.href=e||"",r.innerText=t||e))}},getConjunctionSymbol=e=>"AND"===e?"&&":"OR"===e?"||":"",getCurrentUserStatementCode=(e,t)=>e.key===IS_LOGGED_IN?t+" isLoggedInUser()":t+" !isLoggedInUser()",getCurrentUserRoleStatementCode=(e,t)=>{var{key:e,value:a}=e;return e===EQUALS?t+` isLoggedInUserRole('${a}')`:t+` !isLoggedInUserRole('${a}')`},getKeySymbol=e=>e===EQUALS?"===":e===LESS_THAN?"<":e===LESS_THAN_EQUALS_TO?"<==":e===GREATER_THAN?">":e===GREATER_THAN_EQUALS_TO?">==":e===NOT_EQUAL?"!==":void 0,getCurrentDateStatementCode=(e,t,a)=>`${a} dateComparison(${e.key},value${t})`;let checkDate=e=>(""+e).match(DATE_REGEX);function dateComparison(e,t){return checkDate(t)?e===EQUALS?moment().isSame(t):e===LESS_THAN?moment().isAfter(t):e===LESS_THAN_EQUALS_TO?moment().isSameOrAfter(t):e===GREATER_THAN?moment().isBefore(t):e===GREATER_THAN_EQUALS_TO?moment().isSameOrBefore(t):void NOT_EQUAL:(console.log("Not Valid date in elemnet"),"true")}const showAlertMessage=function(e){var t=e.response;const a=e.element;a.getElementsByClassName("alert-message")[0],a.getElementsByClassName("success-message")[0];let r={};return(r.data=t)?201===t.status||200===t.status?(toastr.success(e.parameters.successMessage,"Success"),r.status="success"):(409===t.status?toastr.error(t.data||"Validation Failed","Error: "+t.status):404===t.status?toastr.error(t.data.error||"This collection does not found","Error: "+t.status):403===t.status?toastr.error(e.parameters.errorMessage||"Forbidden Access","Error: "+t.status):toastr.error(t.data.error||"Some Internal error","Error: "+t.status),r.status="error"):(toastr.error("Sorry,We are not able get response from previos actions","Error"),r.status="error"),r},saveCollection=async e=>{var t=await serializeFormData(e.element.elements);let a=e.element;var{constructor:r,successMessage:o,errorMessage:s,passPreviousActionFormData:n}=e.parameters;let l=!0,i=(!e.parameters||e.parameters.collectionRequest&&"Open"!=e.parameters.collectionRequest||(l=!1),!n||1!=n&&"true"!==n||((e=sessionStorage.getItem("previousActionFormData"))?(e=JSON.parse(e),sessionStorage.setItem("previousActionFormData",JSON.stringify({...e,...t}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(t))),a.getAttribute("action"));a.getAttribute("method");i=i+"/constructor/"+r;let c={},u;try{u=l?await securedPostCall(t,i):(i="open/"+i,await unSecuredPostCall(t,i)),c.data=u,c.data.collectionSaveOrUpdateResponse=u,c.data.collectionFormData=t,c.status="success";var d=c.data["collectionSaveOrUpdateResponse"],{config:m,data:p}=d;let e=m.url;e=(e=e.split("collection-form/")[1]).split("/items")[0];var g=p.uuid,f="collection_"+e,y={[f]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...y}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(y)),c.data={...c.data,...y},resetCollectionForm(a),o&&toastr.success(o,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),s?toastr.error(s,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return c},sendDataToExternalApi=async t=>{const{parameters:e,targetElement:a}=t;var{webhookId:r,passPreviousActionResponse:o,passPreviousActionFormData:s,bodyDataFrom:n}=e;let l=a?a.getAttribute("data-item-id"):"";var i,c,u=t.response;l=u?u.data.uuid:l;let d={},m=(n&&"formData"===n&&(d=await serializeFormData(t.element.elements,!0)),{}),p={};try{if(r){let e="external-api";l||((g=sessionStorage.getItem("previousActionResponse"))&&(g=JSON.parse(g))[f="parentCollectionToPropagate"]&&(g[f].name,l=g[f].uuid),!l&&u&&(y=u["collectionSaveOrUpdateResponse"],y&&(S=y["data"],l=S.uuid))),n&&"collectionItem"!==n||!l?l&&"collectionItemAndFormData"===n&&(e=e+"/"+l,d=u.collectionFormData):e=e+"/"+l;var g,f,y,S,v={data:d,externalApiId:r},h=(p=await unSecuredPostCall(v,e),m.data={...u,...p},m.data.externalApiResponse=p,m.status="success",sessionStorage.getItem("previousActionFormData"));h?(h=JSON.parse(h),sessionStorage.setItem("previousActionFormData",JSON.stringify({...h,...d}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(d))}!o||1!=o&&"true"!==o||((i=sessionStorage.getItem("previousActionResponse"))?(i=JSON.parse(i),sessionStorage.setItem("previousActionResponse",JSON.stringify({...i,...p.data}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(p.data))),!s||1!=s&&"true"!==s||((c=sessionStorage.getItem("previousActionFormData"))?(c=JSON.parse(c),sessionStorage.setItem("previousActionFormData",JSON.stringify({...c,...d}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(d)))}catch(e){if(console.log("%c==> External API error :>> ","color:red",e),e.response){const d=e.response["data"];t=d?d.message||d:"Failed";toastr.error(t,"Error"),m.data=e.response,m.data.externalApiResponse=e.response,m.status="error"}}return m},sendDataToExternalApiAndAuthorize=async o=>{const{parameters:e,targetElement:t}=o,{webhookId:s,bodyDataFrom:n,userRole:l,successMessage:i,redirectUrl:c,sessionValue:u}=e;console.log("sessionValue",u);let d=t?t.getAttribute("data-item-id"):"";var m=o.response;d=m?m.data.uuid:d,console.log("sendDataToExternalApiAndAuthorize 5",d);let p={};n&&"formData"===n&&(console.log("sendDataToExternalApiAndAuthorize 6"),p=await serializeFormData(o.element.elements,!0)),n&&"urlQueryParams"===n&&console.log("sendDataToExternalApiAndAuthorize 7"),console.log("%c data","color:yellow",p);if(console.log("sendDataToExternalApiAndAuthorize 9"),s&&l){console.log("sendDataToExternalApiAndAuthorize 10");let t=sessionStorage.getItem("previousActionResponse"),e=(console.log("1 previousActionResponse",t),t=t&&JSON.parse(t),console.log("2 previousActionResponse",t),"external-api");d||(t&&0<Object.keys(t).length&&(o="parentCollectionToPropagate",t[o]&&(t[o].name,d=t[o].uuid)),!d&&m&&(o=m["collectionSaveOrUpdateResponse"],o&&(o=o["data"],d=o.uuid))),console.log("%c collectionItemId","color:blue",d),n&&"collectionItem"!==n||!d?d&&"collectionItemAndFormData"===n&&(e=e+"/"+d,p=m.collectionFormData):e=e+"/"+d;let a={};u&&t&&0<Object.keys(t).length&&u.split(",").forEach(e=>a[e]=_.get(t,e)),console.log("%c finalSessionValue","color:blue",a),console.log("sendDataToExternalApiAndAuthorize 15",e,p);o="/login/otp/"+e;let r={};try{console.log("sendDataToExternalApiAndAuthorize 16",o);var g={data:p,externalApiId:s,userRole:l,userName:"sdsd",password:"csdcs",sessionValue:a},f=await axios.post(o,g,{}),y=f.data;if(console.log("responseData",y),200===f?.status){let e=window.localStorage;e.setItem("token",y.token),e.setItem("user",JSON.stringify(y.userDetails)),e.setItem("projectId",y.projectId),e.setItem("role",y.role),c&&(window.location=c),toastr.success(i,"Success")}}catch(e){console.log("sendDataToExternalApiAndAuthorize 17"),console.log("error sendDataToExternalApiAndAuthorize",e),e.response&&(r.data=e.response,r.status="error")}return r}return toastr.error("Issue with configuration contact owner","Error"),{}},updateCollection=async e=>{var t=await serializeFormData(e.element.elements);let a=e.element;var{collectionRequest:r,successMessage:o,errorMessage:s,passPreviousActionFormData:n}=e.parameters;let l=!0,i=(!e.parameters||r&&"Open"!=r||(l=!1),!n||1!=n&&"true"!==n||((e=sessionStorage.getItem("previousActionFormData"))?(e=JSON.parse(e),sessionStorage.setItem("previousActionFormData",JSON.stringify({...e,...t}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(t))),a.getAttribute("action"));a.getAttribute("method"),a.getElementsByClassName("alert-message")[0],a.getElementsByClassName("success-message")[0];let c={},u;try{u=l?await securedPutCall(t,i):(i="open/"+i,await unSecuredPutCall(t,i)),c.data=u,c.data.collectionSaveOrUpdateResponse=u,c.status="success";var d=c.data["collectionSaveOrUpdateResponse"],{config:m,data:p}=d;let e=m.url;e=(e=e.split("collection-form/")[1]).split("/items")[0];var g=p.uuid,f="collection_"+e,y={[f]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...y}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(y)),c.data={...c.data,...y},o&&toastr.success(o,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),s?toastr.error(s,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return c},bulkUpdateCollection=async e=>{var t=await serializeFormData(e.element.elements);let a=e.element;var{collectionRequest:r,successMessage:o,errorMessage:s,passPreviousActionFormData:n}=e.parameters;let l=!0,i=(!e.parameters||r&&"Open"!=r||(l=!1),!n||1!=n&&"true"!==n||((e=sessionStorage.getItem("previousActionFormData"))?(e=JSON.parse(e),sessionStorage.setItem("previousActionFormData",JSON.stringify({...e,...t}))):sessionStorage.setItem("previousActionFormData",JSON.stringify(t))),a.getAttribute("action"));a.getAttribute("method"),i+="/bulk/update",a.getElementsByClassName("alert-message")[0],a.getElementsByClassName("success-message")[0];let c={},u;try{u=l?await securedPutCall(t,i):(i="open/"+i,console.log("endpoint 4:>> ",i),await unSecuredPutCall(t,i)),c.data=u,c.data.collectionSaveOrUpdateResponse=u,c.status="success";var d=c.data["collectionSaveOrUpdateResponse"],{config:m,data:p}=d;let e=m.url;e=(e=e.split("collection-form/")[1]).split("/items")[0];var g=p.uuid,f="collection_"+e,y={[f]:{uuid:g}},S=sessionStorage.getItem("previousActionResponse");S?(S=JSON.parse(S),sessionStorage.setItem("previousActionResponse",JSON.stringify({...S,...y}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(y)),c.data={...c.data,...y},o&&toastr.success(o,"Success")}catch(e){e.response&&(c.data=e.response,c.data.collectionSaveOrUpdateResponse=e.response,c.status="error"),s?toastr.error(s,"Error"):e.response.data&&toastr.error(e.response.data,"Error")}return c},updateCollectionOnPageLoad=async e=>{const{parameters:t,response:a,targetElement:r,url_params:o}=e,{collection:s,collectionUpdateFields:n,byPreviousActionResponse:l,updateFindByField:i,updateFindByResponseKeyForValue:c}=t,u=a?a.data:"";var d,m,p,e=u?u.uuid:r.getAttribute("data-item-id");let g={},f=(n.forEach(e=>{"previousActionResponse"===e.valueFrom?g[e.key]=u?u[e.value]:"":"derived-field"===e.valueFrom?g[e.key]=u?getDerivedFieldData(e.value,u):"":g[e.key]=e.value}),{});try{o.token?(d="collection-form/"+s+"/items/"+o.id,f.data=await securedPutCallWithToken(g,d,o.token)):l&&"byPreviousActionResponse"===l?(m=`open/collection-form/${s}/items/${i}/value/`+(u?u[c]:""),f.data=await unSecuredPutCall(g,m)):(p="collection-form/"+s+"/items/"+e,f.data=await unSecuredPutCall(g,p)),f.status="success"}catch(e){e.response&&(f.data=e.response,f.status="error")}return f},deleteCollectionItem=async e=>{const t=e.targetElement.getAttribute("data-item-id"),{collection:a,confirmationMessage:r,successMessage:o,collectionRequest:s,errorMessage:n}=e.parameters,l=!(!s||"Open"===s);let i={};return await Swal.fire({text:r||"Are you sure about deleting this item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",confirmButtonColor:"#ff0055",cancelButtonColor:"#999999",reverseButtons:!0,focusConfirm:!1,focusCancel:!0}).then(async e=>{if(e.isConfirmed){let e=`collection-form/${a}/items/`+t;try{l?i.data=await securedDeleteCall(e):(e="open/"+e,i.data=await unSecuredDeleteCall(e)),200===i.data.status&&toastr.success(o||"Poof! Your item been deleted!","Success"),i.status="success"}catch(e){e.response&&(i.data=e.response,i.status="error",toastr.error(n||"This item could not be deleted right now.","Error"))}}else i.status="error"}),i},resetTextArea=e=>{let t=$(e).find(".textarea");t.length&&t.each(function(){let e=$(this);e[0].hasAttribute("data-show-editor")&&e.summernote("reset")})},resetCollectionForm=e=>{e.reset(),Array.from(e.getElementsByClassName("file-list-display")).forEach(function(e){e.innerHTML="Select file"}),$(e).find(".select").val("").trigger("change"),resetTextArea(e)},addToCollectionItem=async e=>{let t=await serializeFormData(e.element.elements),a=e.element;var r=e.parameters["collectionRequest"],{itemId:o,dataItemId:s}=t,{formElementCollection:e,formElementCollectionId:n,formParentCollection:l,itemId:i}=e.element.dataset,r=!(!r||"Open"===r);let c={},u=(c[e]=s||i,s||(t.dataItemId=i),Object.assign(t,c),`collection-form/${l}/items/${o}/fields/`+n);a.getAttribute("method");let d={};try{r?d.data=await securedPostCall(t,u):(u="open/"+u,d.data=await unSecuredPostCall(t,u)),d.status="success",d.data.forNextStep="ADD",resetCollectionForm(a)}catch(e){e.response&&(d.data=e.response,d.status="error")}return d},removeFromCollectionItem=async e=>{let t=await serializeFormData(e.element.elements),a=e.element;var{collectionRequest:r,confirmationMessage:o}=e.parameters,{itemId:s,dataItemId:n}=t,{formElementCollection:e,formElementCollectionId:l,formParentCollection:i,itemId:c}=e.element.dataset;const u=!(!r||"Open"===r);let d={},m=(d[e]=n||c,n||(t.dataItemId=c),Object.assign(t,d),`collection-form/${i}/items/${s}/fields/`+l);a.getAttribute("method");let p={};return await Swal.fire({text:o||"Are you sure about removing this item?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"Cancel",confirmButtonColor:"#ff0055",cancelButtonColor:"#999999",reverseButtons:!0,focusConfirm:!1,focusCancel:!0}).then(async e=>{if(e.isConfirmed)try{u?p.data=await securedPutCall(t,m):(m="open/"+m,p.data=await unSecuredPutCall(t,m)),p.status="success",p.data.forNextStep="REMOVE",resetCollectionForm(a)}catch(e){e.response&&(p.data=e.response,p.status="error")}else p.data=e,p.status="cancel"}),p},logoutUser=async function(e){e=e.parameters.redirectUrl;try{200===(await axios.post("/logout")).status&&(window.localStorage.clear(),window.location=e)}catch(e){console.log("e logout",e)}};async function loginUser(e){let t=e.element;var a=t.getElementsByClassName("alert-message")[0],r={userName:t.elements.userName.value,password:t.elements.password.value};e.response&&201!==e.response.status?e.response.data.status:await loginIntoApplication(r,null,a,e.parameters.redirectRules,LOGIN_USER)}async function loginUserWithFirebase(e){let t=e.element;var a=t.getElementsByClassName("alert-message")[0],r={userName:t.elements.userName.value,password:t.elements.password.value};e.response&&201!==e.response.status?e.response.data.status:await loginIntoApplication(r,null,a,e.parameters.redirectRules,LOGIN_WITH_FIREBASE)}async function loginUserWithXano(e){let t=e.element;var a=t.getElementsByClassName("alert-message")[0],r={userName:t.elements.userName.value,password:t.elements.password.value};e.response&&201!==e.response.status?e.response.data.status:await loginIntoApplication(r,null,a,e.parameters.redirectRules,LOGIN_WITH_XANO)}async function loginUserWithBackendless(e){let t=e.element;var a=t.getElementsByClassName("alert-message")[0],r={userName:t.elements.userName.value,password:t.elements.password.value};e.response&&201!==e.response.status?e.response.data.status:await loginIntoApplication(r,null,a,e.parameters.redirectRules,LOGIN_WITH_BACKENDLESS)}const loginUserWithToken=async function(e){var t={token:e.url_params.token};await loginIntoApplication(t,null,null,e.parameters.redirectRules,LOGIN_WITH_TOKEN)},signUpUser=async function(e){var{element:e,parameters:t}=e;const a=await serializeFormData(e.elements);return a.userRoles=t.userRole,await processSignUpUser(a,"auth/user",e,t)},processSignUpUser=async function(e,t,a,r){let o=a.getElementsByClassName("alert-message")[0];var{successMessage:a,errorMessage:r}=r;let s={};try{s.data=await publicPostCall(e,t),s.status="success",o&&(o.style.display="none"),a&&toastr.success(a,"Success")}catch(e){o?(r?o.innerHTML=r:e.response&&e.response.data?o.innerHTML=e.response.data:o.innerHTML="Username or Email already exists",o.style.display="block",o.classList.add("mt-3")):r?toastr.error(r,"Error"):e.response&&e.response.data?toastr.error(e.response.data,"Error"):toastr.error("Username or Email already exists","Error"),e.response&&(s.data=e.response,s.status="error")}return s},signUpUserWithFirebase=async function(e){var{element:e,parameters:t}=e;const a=await serializeFormData(e.elements);return a.userRoles=t.userRole,await processSignUpUser(a,"auth/user/firebase",e,t)},signUpUserWithXano=async function(e){var{element:e,parameters:t}=e;const a=await serializeFormData(e.elements);return a.userRoles=t.userRole,await processSignUpUser(a,"auth/user/xano",e,t)},signUpUserWithBackendless=async function(e){var{element:e,parameters:t}=e;const a=await serializeFormData(e.elements);return a.userRoles=t.userRole,await processSignUpUser(a,"auth/user/backendless",e,t)},signupAndLoginUser=async function(t){var e=t.element;const a=await serializeFormData(e.elements);var{userRole:r,redirectUrl:o}=t.parameters;a.userRoles=r;if(a.hasOwnProperty("password")&&""===a.password){const n=e.elements.password,l=(n.classList.add("error"),document.createElement("label"));return l.setAttribute("id",n.id+"-error"),l.setAttribute("class","error"),l.setAttribute("for",""+n.id),l.innerHTML=n.placeholder||"Please enter password",void n.insertAdjacentElement("afterend",l)}a.hasOwnProperty("password")||a.password||(a.password=Math.floor(1e5+9e5*Math.random()).toString());r={userName:a.userName,password:a.password};let s={};try{s.data=await publicPostCall(a,"auth/user");let e={};a.password&&delete(e=a).password,s.data.data.uuid&&(s.data.userSignupId=s.data.data.uuid),s.data.collectionFormData=e,await loginIntoApplication(r,o,null,t.parameters.redirectRules,LOGIN_USER)}catch(e){e.response&&(s.data=e.response,s.status="error",e.response.data?toastr.error(e.response.data,"Error"):toastr.error("Username or Email already exists","Error"))}return s},resetNewPassword=async function(e){let t=e.element;e=e.parameters;let a=t.getElementsByClassName("alert-message")[0],r=t.getElementsByClassName("success-message")[0];var{password:e,confirmPassword:o}=e,e={password:e?t.elements[e]?t.elements[e].value:"":t.elements.password.value,confirmPassword:e?t.elements[o]?t.elements[o].value:"":t.elements.confirmPassword.value};if(""===e.password&&""===e.confirmPassword)toastr.error("Please fill this field","Error");else if(e.password!==e.confirmPassword)a.innerHTML="password and confirm password does not match",r.style.display="none",a.style.display="block",a.classList.add("mt-3");else try{var s=Object.fromEntries(new URLSearchParams(window.location.search));await securedPostCallWithToken(e,"auth/reset-password/",s.token),t.reset(),r.innerHTML="Your password has been successfully updated",r.style.display="block",r.classList.add("mt-3"),a.style.display="none",window.location="/login"}catch(e){401===e.response.status&&(a.innerHTML=e.response.data.message,r.style.display="none",a.style.display="block",a.classList.add("mt-3"),window.location="/forget-password")}},chnageOldPassword=async function(e){let t=e.element;e=e.parameters;let a=t.getElementsByClassName("alert-message")[0],r=t.getElementsByClassName("success-message")[0];var{oldPassword:e,password:o,confirmPassword:s}=e,e={oldPassword:o?t.elements[e]?t.elements[e].value:"":t.elements.oldPassword.value,password:o?t.elements[o]?t.elements[o].value:"":t.elements.password.value,confirmPassword:o?t.elements[s]?t.elements[s].value:"":t.elements.confirmPassword.value};if(""===e.password&&""===e.confirmPassword)toastr.error("Please fill this field","Error");else if(e.password!==e.confirmPassword)a.innerHTML="Password and Confirm password does not match",r.style.display="none",a.style.display="block",a.classList.add("mt-3");else try{await securedPostCall(e,"auth/change-passoword/");t.reset(),r.innerHTML="Your password has been successfully updated",r.style.display="block",r.classList.add("mt-3"),a.style.display="none"}catch(e){401===e.response.status&&(a.innerHTML=e.response.data.message,r.style.display="none",a.style.display="block",a.classList.add("mt-3"))}},handlePageRedirection=(e,t,a)=>{let r=window.localStorage;r.setItem("token",e.token),r.setItem("user",JSON.stringify(e.userDetails)),r.setItem("projectId",e.projectId),r.setItem("role",e.role);const o=(e.userDetails||{})["userRoles"];(t=a?(e=a.find(e=>Array.isArray(o)?o.includes(e.role):e.role===o))?e.page:"":t)&&(window.location=t)},loginIntoApplication=async function(a,r,t=null,o=null,s=LOGIN_USER){try{let e="",t={};e=s===LOGIN_WITH_TOKEN?(t=getHeaderForSeverForSecuredRequestWithToken(a.token),"/login-with-token"):s===LOGIN_WITH_FIREBASE?"/login/firebase":s===LOGIN_WITH_XANO?"/login/xano":s===LOGIN_WITH_BACKENDLESS?"/login/backendless":"/login";var n,l=await axios.post(e,a,t),i=l.data;if(200===l?.status){await handlePageRedirection(i,r,o);const c=(i.userDetails||{})["userRoles"];!o||(n=o.find(e=>Array.isArray(c)?c.includes(e.role):e.role===c))&&n.successMessage&&toastr.success(n.successMessage,"Success")}}catch(e){s=e["response"];if(s){const{status:u,data:a}=s;let e="";a&&({message:l,error:r}=a,(l||r)&&(e=l||r)),e=e||(401===u?"Username or password does not match. Please try again":404===u||400===u?"This user does not exists.":"Some Internal error. Please contact support."),t?(t.style.display="block",t.classList.add("mt-3"),t.innerHTML=e):toastr.error(e,"Error")}}},goToPage=a=>{var{parameters:{sendCurrentObjectID:a,sendExternalApiMiddlewareId:e,destination:r,sendPreviousStepParentCollectionId:t},response:o}=a;let s=r;if(o&&"undefined"!==o){var{status:r,data:n,collectionSaveOrUpdateResponse:l,externalApiResponse:i,userSignupId:c}=o,l=(l||i||o)["config"];if(r&&"error"===r)return o;if(a&&(1==a||"true"===a)){let e=l.url,t=(e=(e=e.split("collection-form/")[1])?e.split("/items")[0]:"",n.uuid);!e&&c?(e=COLLECTION_USER,t=c):!t&&e&&(i=sessionStorage.getItem("previousActionResponse"))&&(i=JSON.parse(i),r="collection_"+e,t=i[r].uuid);o={parentCollectionToPropagate:{uuid:t,name:e}},a=sessionStorage.getItem("previousActionResponse");a?(a=JSON.parse(a),sessionStorage.setItem("previousActionResponse",JSON.stringify({...a,...o}))):sessionStorage.setItem("previousActionResponse",JSON.stringify(o)),s+=`/${e}/`+t}if(t&&(1==t||"true"===t)){let e="";e||(l=sessionStorage.getItem("previousActionResponse"))&&(c="parentCollectionToPropagate",(l=JSON.parse(l))[c]&&(i=l[c].name,e=l[c].uuid,s+=`/${i}/`+e))}!e||1!=e&&"true"!==e||(r=n.externalApiMiddlewareId,s+="?externalId="+r)}window.location=s},dynamicPageRedirect=async e=>{var{element:e,parameters:t,response:a}=e;const i=e.dataset.collectionItem?JSON.parse(e.dataset.collectionItem):a&&a.collectionSaveOrUpdateResponse?a.collectionSaveOrUpdateResponse.data:{},{collectionFrom:c,fieldName:r,redirectRules:o}=t;console.log("collectionItem",i);let s={},u=("collections"===c?s=i:"page"===c?(e=(await getPageItemData())["itemData"],s=e):"session"===c&&(a=localStorage.getItem("user"),s=a?JSON.parse(a):{}),""),d=(u="sessionActionResponse"===c?(u=parseSessionObject(r))&&u.toString():parseValueFromData(s,r),""),m=!0;if(o.forEach(async r=>{var{fieldValue:r,page:o,pathField:s,seoField:n,target:l}=r;if(r===u){let e="",t="",a="";s&&(r=await getUrlWithSeoAndPathField(s,null,c,i),e=r.pathId,t=r.pathCollection),n&&(a=await getUrlWithSeoAndPathField(null,n,c,i)),d="/"+o,(d=e&&t?`${d}/${t}/`+(a||"")+e:d)&&(m=!1),l?window.open(d,"_blank").focus():window.location=d}}),m){const n=["null","NULL","DEFAULT","EMPTY"];t=o&&o.length?o.find(e=>n.includes(e.fieldValue.trim())):"";t&&({page:e,target:a}=t,d="/"+e,a?window.open(d,"_blank").focus():window.location=d)}},getUrlWithSeoAndPathField=async(e,t,a,r)=>{var{fieldFrom:o,collectionName:s,fieldName:n}=e?JSON.parse(e):JSON.parse(t);let l={};return"eventCollection"===o&&"page"===a?(a=(await getPageItemData())["itemData"],l=a):"eventCollection"===o?l=r:"session"===o&&(a=localStorage.getItem("user"),l=JSON.parse(a)),e?{pathId:parseValueFromData(l,n),pathCollection:s}:t?(r=parseValueFromData(l,n),slugify(r)):void 0},reloadPage=()=>{window.location.reload()},refreshSection=async function(e){let t=e.parameters.refreshComponent;var r=e.parameters.refreshComponentPosition,o=t.split(":")[0],s=t.split(":")[1];const a=document.getElementById(s);if(a&&a.attributes.getNamedItem("data-js")&&a.attributes["data-js"].value===o){let t={},a={};paginationDataMap.get("pdata_"+s)&&(t=paginationDataMap.get("pdata_"+s));o=dataTablePaginationDataMap.get("ptdata_"+s);if("End"===r||"Beginning"===r)await appendPrepend(o,e.response,r);else{if(o&&(a=o).fieldName){s=(await getPageItemData())["itemData"];let e=parseValueFromData(s,a.fieldName);e=Array.isArray(e)?e:0<Object.keys(e).length?[e]:[],a.itemIds=e}if(t&&void 0!==t.replacedElement){e=t.numberPerPage,r=t.currentPage;if(t.fieldName){o=(await getPageItemData())["itemData"];let e=parseValueFromData(o,t.fieldName);e=Array.isArray(e)?e:0<Object.keys(e).length?[e]:[],t.itemIds=e}modifyPaginationDataForRefresh(t),loadGroupData(t),resetPaginationData(t,e,r)}a&&void 0!==a.dataTable&&loadDataList(a)}}},appendPrepend=async(a,r,o)=>{if(r&&0!==Object.keys(r).length){let{data:e,forNextStep:t}=r;if(t){if("REMOVE"===t){r=e["dataItemId"];if(r){let e=document.querySelector(`tr>td>form[data-item-id="${r}"]`).parentNode;"TR"===e.nodeName?e.remove():"TR"!==(e=e.parentNode).nodeName&&"TR"!==(e=e.parentNode).nodeName||e.remove()}}else if("ADD"===t){const s=e["itemData"];if(a&&"undefined"!==a){const{fieldName:n,dataTable:l}=a,i=e[n][0];l&&l.innerHTML&&l.innerHTML.includes(i)||(e=s[n].find(e=>e.uuid===i),await processPrependAndAppend(e,a,o))}}}else await processPrependAndAppend(e,a,o)}else console.log("No response came from server")},processPrependAndAppend=async(e,t,a)=>{const{firstRowElements:r,columnsMap:o,tbodyElement:s,dataTable:n}=t;t=await getTableColumns(e,o,r);const l="TR"===r.tagName?r:"";let i="";l&&(e=l.cloneNode(!0),i=elementAttribute(l,"id"),applyUserDefinedStyles(e,l,dataTableStylesMap));e=`<tr ${setIdAttribute(i)}>${t}</tr>`,t=s.innerHTML,s.innerHTML="","End"===a?s.innerHTML=t+e:"Beginning"===a&&(s.innerHTML=e+t),a=n.getAttribute("id"),e=document.getElementById(a);const c=$(e).find(".no-record-data-table");c.remove()},modifyPaginationDataForRefresh=async function(e){e.numberPerPage=e.currentPage*e.numberPerPage,e.currentPage=1;var t=createContentPlaceholder(e.replacedElement.childElementCount||1,e.dataGroupChildren[0].id,e.dataGroupChildren[0].className);e.replacedElement.innerHTML=t},SERVER_URL=(resetPaginationData=async function(e,t,a){e.numberPerPage=t,e.currentPage=a},getBackendServerUrl());let localStorage=window.localStorage;const getHeaderForSeverForSecuredRequest=()=>{var e=localStorage.getItem("token");return{headers:{"Content-Type":"application/json","x-project-id":localStorage.getItem("projectId"),authorization:e}}},getHeaderForSeverForSecuredRequestWithToken=e=>({headers:{"Content-Type":"application/json",authorization:"Bearer "+e}}),getHeaderForServerForPublicRequest=()=>{var e=localStorage.getItem("projectId"),t=localStorage.getItem("token");return t?{headers:{"Content-Type":"application/json","x-project-id":e,authorization:t}}:{headers:{"Content-Type":"application/json","x-project-id":e}}},headerMultipartFormDataForSecuredRequest=()=>{var e=localStorage.getItem("token");return{headers:{"Content-Type":"multipart/form-data","x-project-id":localStorage.getItem("projectId"),authorization:e}}},headerMultipartFormDataForPublicRequest=()=>({headers:{"Content-Type":"multipart/form-data","x-hostname":window.location.hostname}}),headerJsonDataForPublicRequest=()=>({headers:{"Content-Type":"application/json","x-hostname":window.location.hostname}}),publicPostCall=async(e,t)=>{var a=headerJsonDataForPublicRequest();return axios.post(getBackendServerUrl()+t,e,a)},publicGetCall=async t=>{try{var a=getHeaderForServerForPublicRequest();return await axios.get(getBackendServerUrl()+t,a)}catch(e){if(e.response){a=e.response["status"];if(401==a&&t.includes("finder"))return{data:t.includes("count")?0:[],_$isPrivateFilter:!0}}throw Error(e)}},unSecuredPostCall=async(e,t)=>{var a=getHeaderForServerForPublicRequest();return axios.post(SERVER_URL+t,e,a)},securedPostCall=async(e,t)=>{var a=getHeaderForSeverForSecuredRequest();return axios.post(SERVER_URL+t,e,a)},securedGetCall=async t=>{try{var a=getHeaderForSeverForSecuredRequest();return await axios.get(SERVER_URL+t,a)}catch(e){if(e.response){a=e.response["status"];if(401==a&&t.includes("finder"))return{data:t.includes("count")?0:[],_$isPrivateFilter:!0}}throw Error(e)}},securedPutCall=async(e,t)=>{var a=getHeaderForSeverForSecuredRequest();return axios.put(SERVER_URL+t,e,a)},unSecuredPutCall=async(e,t)=>{var a=getHeaderForServerForPublicRequest();return axios.put(SERVER_URL+t,e,a)},securedDeleteCall=async e=>{var t=getHeaderForSeverForSecuredRequest();return axios.delete(SERVER_URL+e,t)},unSecuredDeleteCall=async e=>{var t=getHeaderForServerForPublicRequest();return axios.delete(SERVER_URL+e,t)},multipartFormDataPublicCall=async(e,t)=>{headerMultipartFormDataForPublicRequest();return axios.post(SERVER_URL+t,e)},multipartFormDataSecuredCall=async(e,t)=>{var a=headerMultipartFormDataForPublicRequest();return axios.post(SERVER_URL+t,e,a)},getCall=async e=>{var t=getHeaderForSeverForSecuredRequest();return axios.get(SERVER_URL+e,t)},securedPostCallWithToken=async(e,t,a)=>{a=getHeaderForSeverForSecuredRequestWithToken(a);return axios.post(SERVER_URL+t,e,a)},securedPutCallWithToken=async(e,t,a)=>{a=getHeaderForSeverForSecuredRequestWithToken(a);return axios.put(SERVER_URL+t,e,a)},system_show_component=async function(e){let t=e.parameters.showComponents;e=t.split(":")[1];const a=document.getElementById(e);if(!a)return null;a.classList.contains("d-none")&&a.classList.remove("d-none");e=a.style.display;a.style.display=e&&"none"!==e?e:"block",a.style.visibility="visible"},system_hide_component=async function(e){let t=e.parameters.hideComponents;e=t.split(":")[1];const a=document.getElementById(e);if(!a)return null;a.classList.contains("d-none")||a.classList.add("d-none"),a.style.display="none",a.style.visibility="hidden"},getFormDataOfElement=e=>{let a={};return Object.values(e.elements).map(e=>{if(e.name)if("hidden"===e.type)a[e.name]=e.value;else if("SELECT"===e.tagName){const t=[...e.selectedOptions].map(e=>e.value);a[e.name]=1===t.length?t.join(""):t}else a[e.name]=e.value}),a},serializeFormData=async(a=[],o=!1)=>{var s={};for(let t=0;t<a.length;t++){const i=a[t];let e;if("file"===i.type&&o){var n=i.files,n=await createFileInServerLocal(n,i,e);e=n?n.path||"":i.value||""}else if("radio"===i.type)e=i.checked?i.value:"";else if("checkbox"===i.type&&"select"===$(i).attr("data-component-type"))e=i.checked?i.value:"";else if("checkbox"===i.type)e=i.checked;else if("SELECT"===i.tagName){const c=[...i.selectedOptions].map(e=>e.value);e=1===c.length?c.join(""):c.filter(e=>""!==e)}else e="tel"===$(i).attr("type")?$(i).intlTelInput("getNumber"):"number"===i.type?""===i.value?"":Number(i.value):"datetime-local"===$(i).attr("flat-picker-date-type")?i.value?flatpickr.parseDate(i.value,"Z"):"":trim(i.value);"file"===i.type&&e.includes("fakepath")&&(e="");let r=i.getAttribute("name");if(r){var l=r.split(".");let t="",a=s;for(let e=0;e<l.length-1;e++)(t=l[e]).includes("[")&&(t=t.replace("[]","")),a[t]||(a[t]={}),a=a[t];(t=l[l.length-1]).includes("[")&&(t=t.replace("[]","")),a[t]?(n=a[t]+","+e,a[t]=e?n:a[t]):a[t]=e}}return s},findFieldValueFromFormData=(e,t)=>{let a={};return Object.values(e.elements).map(e=>{if(e.name)if("hidden"===e.type)a[e.name]=e.value;else if("SELECT"===e.tagName){const t=[...e.selectedOptions].map(e=>e.value);a[e.name]=1===t.length?t.join(""):t}else a[e.name]=e.value}),a},sortTableColumn=(c,u)=>{if(console.log("*** Sorting Table Column :>> ",c,"Id :>>",u),u){var d=document.getElementById(u);let a,r,o,s,n,e=0,t=!0,l=!1,i="ascending";for(;t;){for(t=!1,r=d.rows,a=r[0].getElementsByTagName("TH")[c],o=1;o<r.length-1;o++){l=!1,s=r[o].getElementsByTagName("TD")[c],n=r[o+1].getElementsByTagName("TD")[c];let e=s.textContent.toLowerCase(),t=n.textContent.toLowerCase();if(e&&!isNaN(e)&&(e=Number(e)),t&&!isNaN(t)&&(t=Number(t)),"ascending"==i){if(a.children[0].classList.remove("sortable-desc"),a.children[0].classList.add("sortable-asc"),e>t){l=!0;break}}else if("descending"==i&&(a.children[0].classList.remove("sortable-asc"),a.children[0].classList.add("sortable-desc"),e<t)){l=!0;break}}l?(r[o].parentNode.insertBefore(r[o+1],r[o]),t=!0,e++):0==e&&"ascending"==i&&(i="descending",t=!0)}}},customPageRedirect=e=>{var{redirectValueFrom:t,destination:a}=e["parameters"];let r=a;switch(t){case"SESSION":(r="SESSION"===t?customPageRedirectFromSessionValue(a,r):r)&&(window.location=r);break;case"BASE64_FORM_SUBMIT_SESSION_VALUE":customPageRedirectBase64SessionValue(a);break;case"FORM_SUBMIT_SESSION_VALUE":customPageRedirectHtmlSessionValue(a);break;default:r&&(window.location=r)}},getContentFromSessionObject=(e,t)=>{return _.get(e,t)},createFileInServerLocal=async(e,t,a)=>{const r=new FormData;r.append("file",e[0]),e=(await multipartFormDataSecuredCall(r,"file/upload/local")).data;return e},registerServiceWorker=async()=>{console.log("Checking to enable PWA...");var e=await getProjectDetail();if(e){e=e["enablePWA"];if(e&&"serviceWorker"in navigator)try{var t=await navigator.serviceWorker.register("/serviceWorker.js",{scope:"./"});t.installing?console.log("%c==> Service worker installing","color:yellow"):t.waiting?console.log("%c==> Service worker installed","color:cyan"):t.active&&console.log("%c==> Service worker active","color: yellowGreen")}catch(e){console.error("%c==> Registration failed with "+e,"color:red")}}},getProjectDetail=async()=>{var e=(await publicGetCall("projects/detail/"))["data"];return e},parseSessionObject=e=>{let t="";var a=sessionStorage.getItem("previousActionResponse");return a&&(a=JSON.parse(a),t=getContentFromSessionObject(a,e)),t},customPageRedirectFromSessionValue=(e,t)=>{e=parseSessionObject(e);return e||""},customPageRedirectBase64SessionValue=e=>{var e=parseSessionObject(e);e&&(e=window.atob(e),e=URL.createObjectURL(new Blob([e],{type:"text/html"})),window.open(e,"_self","width=800,height=400,screenX=200,screenY=200"))},customPageRedirectHtmlSessionValue=e=>{var e=parseSessionObject(e);e&&(e=URL.createObjectURL(new Blob([e],{type:"text/html"})),window.open(e,"_self","width=800,height=400,screenX=200,screenY=200"))},toggleAllDataTableItems=(e,t)=>{var a=e.target;if(a&&t){const r=document.getElementById(t),o=r.querySelectorAll("[data-gjs=dt-item-check]");for(let e=0;e<o.length;e++)"checkbox"==o[e].type&&(o[e].checked=a.checked)}};
//# sourceMappingURL=drapcode.js.map